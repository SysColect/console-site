import{j as o,e as x,c as S,u as N,s as R,C as h,r as i,Q as L,a as D,L as M}from"./index-Rp__Yzw6.js";import{T as A}from"./ToolPageLayout-Pac0z1lb.js";import{F as w,R as G,N as v}from"./firestore.source-CSakcEFQ.js";const q=()=>o.jsx(x,{name:"actionProperties.redirectTo",label:"Caminho do Redirecionamento",placeholder:"/tool/some-path",formField:!0}),V=t=>o.jsxs(o.Fragment,{children:[o.jsx(x,{name:"name",label:"Nome",formField:!0}),o.jsx(x,{name:"description",label:"Descrição",multiline:!0,rows:3,formField:!0}),o.jsx(S,{name:"icon",label:"Ícone",formField:!0}),o.jsx(N,{name:"toolGroup",label:"Grupo de Ferramentas",optionsMap:t,formField:!0}),o.jsx(R,{name:"action",label:"Ação",options:[{value:"redirect",label:"Redirecionar"}],formField:!0}),o.jsx(q,{})]}),O=t=>{const a={};if(a.name=h.required("O nome da ferramenta é obrigatório")(t.name),a.icon=h.required("Você deve selecionar um ícone")(t.icon),t.action==="redirect"){const l=t.actionProperties?.redirectTo;a["actionProperties.redirectTo"]=h.required("O caminho para o redirecionamento é obrigatório")(l)}return Object.entries(a).reduce((l,[f,u])=>(u&&(l[f]=u),l),{})},z=()=>{const[t,a]=i.useState([]),[l,f]=i.useState({}),[u,T]=i.useState(!0),[y,g]=i.useState(null),{showConfirmation:b,showAlert:F}=L(),c=i.useMemo(()=>{const e=new w("consoleTool"),r=new v;return new G(e,r)},[]),j=i.useMemo(()=>{const e=new w("consoleToolGroups"),r=new v;return new G(e,r)},[]),p=i.useCallback(async()=>{T(!0),g(null);try{const[e,r]=await Promise.all([c.getAll({sort:{field:"name",direction:"asc"}}),j.getAll({sort:{field:"name",direction:"asc"}})]);a(e);const d=r.reduce((n,s)=>(n[s.id]=s.name,n),{});f(d)}catch(e){console.error("Error fetching data:",e),g("Falha ao carregar os dados. Por favor, tente novamente mais tarde.")}finally{T(!1)}},[c,j]);i.useEffect(()=>{p()},[p]);const C=[{field:"icon",headerName:"Ícone",width:80,renderCell:e=>o.jsx(M,{children:o.jsx("i",{className:`fa-solid fa-${e.value}`,style:{fontSize:20}})})},{field:"name",headerName:"Nome",width:250},{field:"description",headerName:"Descrição",flex:1},{field:"toolGroup",headerName:"Grupo",width:200,valueGetter:e=>l[e]||"-"}],E=async(e,r)=>{const{id:d,...n}=e;(n.toolGroup===""||n.toolGroup===void 0)&&(n.toolGroup=null);try{if(r){const s=await c.create(n);a(m=>[...m,s])}else await c.update(d,n),a(s=>s.map(m=>m.id===d?{...m,...n,id:d}:m))}catch(s){console.error("Error saving tool:",s),F({title:"Erro",message:"Falha ao salvar a ferramenta."})}},P=e=>{b({title:"Confirmar Exclusão",message:`Você tem certeza que deseja excluir a ferramenta ${e.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{await c.delete(e.id),a(t.filter(r=>r.id!==e.id))}catch(r){console.error("Error deleting tool:",r),F({title:"Erro",message:"Falha ao excluir a ferramenta."})}}})};return o.jsx(D,{title:"Ferramentas",rows:t,columns:C,loading:u,error:y,initialValues:{name:"",description:"",icon:"",toolGroup:null,action:"redirect",actionProperties:{redirectTo:""}},dialogTitle:"Ferramenta",onSave:E,onDelete:P,onRefresh:p,onValidate:O,hideAddButton:!1,children:V(l)})},k=()=>o.jsx(A,{title:"Gerenciador de Ferramentas",children:o.jsx(z,{})});export{k as default};
