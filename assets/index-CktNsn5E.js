import{r as s,g as I,j as e,D as P,a as W,b as N,A as z,T as C,h as q,i as T,k as F,z as _,s as G,E as S,l as M,Z as H,u as V,m as X,B as O,C as Z,P as $,I as J,n as K,M as A,o as Q}from"./index-DTgOTrzU.js";import{M as U}from"./MoreVert-sYLAPf0x.js";import{T as Y}from"./ToolPageLayout-C9Py0OxF.js";import{T as ee,a as ae,b as te,c as k,d as u,e as ne}from"./TableRow-BC8ndXSd.js";const se=({open:h,onClose:o,organization:t})=>{const[x,D]=s.useState(""),[m,f]=s.useState(""),[r,l]=s.useState(null),[b,g]=s.useState(null),j=I();s.useEffect(()=>{t?(D(t.name||""),f(t.abbreviation||"")):(D(""),f(""),l(null))},[t]);const p=async()=>{if(g(null),!x||!m){g("Please fill in all required fields.");return}try{if(t){const n=F(j,"organization",t.id),i=await _(n),c={name:x,abbreviation:m,inactivationDate:r};(!i.exists()||!i.data()?.inclusionDate)&&(c.inclusionDate=new Date),await G(n,c,{merge:!0}),o({...t,...c,inclusionDate:c.inclusionDate?S.fromDate(c.inclusionDate):t.inclusionDate,inactivationDate:r?S.fromDate(r):void 0})}else{const n=M(j,"organization"),i={name:x,abbreviation:m,inclusionDate:new Date,inactivationDate:r},c=await H(n,i);o({id:c.id,...i,inclusionDate:S.fromDate(i.inclusionDate),inactivationDate:i.inactivationDate?S.fromDate(i.inactivationDate):void 0})}}catch(n){n instanceof Error?g(n.message):g("An unexpected error occurred."),console.error("Error saving organization:",n)}},y=(n,i)=>{o()};return e.jsxs(P,{open:h,onClose:y,children:[e.jsx(W,{children:t?"Edit Organization":"Add Organization"}),e.jsxs(N,{children:[b&&e.jsx(z,{severity:"error",sx:{mb:2},children:b}),t&&e.jsx(C,{autoFocus:!0,margin:"dense",id:"id",label:"Organization ID",type:"text",fullWidth:!0,disabled:!0,value:t?.id||""}),e.jsx(C,{margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,value:x,onChange:n=>D(n.target.value)}),e.jsx(C,{margin:"dense",id:"abbreviation",label:"Abbreviation",type:"text",fullWidth:!0,value:m,onChange:n=>f(n.target.value)}),e.jsx(C,{margin:"dense",id:"inclusionDate",label:"Inclusion Date",type:"text",fullWidth:!0,disabled:!0,value:t?.inclusionDate?t.inclusionDate instanceof Date?t.inclusionDate.toLocaleDateString():new Date(t.inclusionDate.seconds*1e3).toLocaleDateString():new Date().toLocaleDateString()}),e.jsx(C,{margin:"dense",id:"inactivationDate",label:"Inactivation Date",type:"date",fullWidth:!0,value:r?r.toISOString().split("T")[0]:"",onChange:n=>l(new Date(n.target.value)),InputLabelProps:{shrink:!0}})]}),e.jsxs(q,{children:[e.jsx(T,{onClick:()=>o(),children:"Cancel"}),e.jsx(T,{onClick:p,children:"Save"})]})]})},ce=()=>{const[h,o]=s.useState([]),[t,x]=s.useState(!0),[D,m]=s.useState(null),[f,r]=s.useState(null),[l,b]=s.useState(null),[g,j]=s.useState(!1),p=I(),{showConfirmation:y,showAlert:n}=V(),i=s.useCallback(async()=>{x(!0),m(null);try{const a=M(p,"organization"),v=(await X(a)).docs.map(w=>({id:w.id,...w.data()}));o(v)}catch(a){console.error("Error fetching organizations:",a),m("Falha ao carregar organizações. Tente novamente mais tarde.")}finally{x(!1)}},[p]);s.useEffect(()=>{i()},[i]);const c=(a,d)=>{r(a.currentTarget),b(d)},E=()=>{r(null)},L=()=>{j(!0),E()},R=()=>{E(),l&&y({title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir a organização ${l.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{if(!l)return;const a=F(p,"organization",l.id);await Q(a),o(h.filter(d=>d.id!==l.id))}catch(a){console.error("Error deleting organization:",a),n({title:"Erro",message:"Falha ao excluir organização. Tente novamente mais tarde."})}}})},B=()=>{b(null),j(!0)};return e.jsx(Y,{title:"Gerenciador de Organizações",actions:e.jsx(T,{variant:"contained",color:"secondary",onClick:B,children:"Incluir Organização"}),children:t?e.jsx(O,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Z,{})}):D?e.jsx(z,{severity:"error",children:D}):e.jsxs(O,{sx:{width:"100%",overflowX:"auto"},children:[e.jsx(ee,{component:$,children:e.jsxs(ae,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(te,{children:e.jsxs(k,{children:[e.jsx(u,{children:"ID da Organização"}),e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Abreviação"}),e.jsx(u,{children:"Ações"})]})}),e.jsx(ne,{children:h.map(a=>e.jsxs(k,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(u,{component:"th",scope:"row",children:a.id}),e.jsx(u,{children:a.name||"N/A"}),e.jsx(u,{children:a.abbreviation||"N/A"}),e.jsx(u,{children:e.jsx(J,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:d=>c(d,a),children:e.jsx(U,{})})})]},a.id))})]})}),e.jsxs(K,{id:"long-menu",anchorEl:f,open:!!f,onClose:E,children:[e.jsx(A,{onClick:L,children:"Editar"}),e.jsx(A,{onClick:R,children:"Excluir"})]}),e.jsx(se,{open:g,onClose:a=>{if(a){const d=h.find(v=>v.id===a.id);o(d?h.map(v=>v.id===a.id?a:v):[a,...h])}j(!1)},organization:l})]})})};export{ce as default};
