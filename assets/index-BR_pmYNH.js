import{j as e,L as z,N as S,at as U,r as o,au as D,av as f,aw as w,B as g,p,A as j,b as C,ax as I,ay as N,az as T,V as A,T as E}from"./index-BDy3NKKd.js";import{T as L}from"./ToolPageLayout-B78edoqV.js";import{f as V}from"./dateUtils-DVhnkKif.js";const B=({users:i,organization:l})=>{const m=[{field:"name",headerName:"Nome",flex:1},{field:"email",headerName:"Email",flex:1},{field:"role",headerName:"Role",flex:1,valueGetter:s=>s?.row?.role||"user"},{field:"inactivationDate",headerName:"Data Inativação",flex:1,valueGetter:s=>{const t=V(s?.value);return t?t.toLocaleDateString():"-"}}],n=(s,t)=>{console.log("Save",s,t)},x=s=>{console.log("Delete",s)},h=[{label:"User",value:"user"},{label:"Supervisor",value:"supervisor"},{label:"Admin",value:"admin"}];return e.jsx(z,{title:`Usuários em ${l.name}`,rows:i,columns:m,onSave:n,onDelete:x,initialValues:{role:"user",inactivationDate:null},dialogTitle:"Editar Vínculo do Usuário",hideAddButton:!0,children:e.jsx(S,{name:"role",label:"Role",options:h})})},G=()=>{const{userData:i}=U(),[l,m]=o.useState([]),[n,x]=o.useState(null),[h,s]=o.useState([]),[t,c]=o.useState(!0),[u,d]=o.useState(null),O=D(),v=o.useCallback(async()=>{try{if(c(!0),!i)throw new Error("Usuário não autenticado.");let a=[];if(i?.adminConsole)a=await f.getAllOrganizations();else{const r=await w.getUserOrganizationIds(i.id);r.length>0&&(a=await f.getOrganizationsByIds(r))}m(a),a.length===0&&d("Você não tem permissão para gerenciar usuários de nenhuma organização.")}catch(a){d(a.message||"Ocorreu um erro ao buscar as organizações.")}finally{c(!1)}},[i]);o.useEffect(()=>{v()},[v]);const b=async a=>{try{c(!0),d(null);const r=await f.getOrganizationData(a);x(r),r&&s([])}catch(r){d(r.message||"Ocorreu um erro ao buscar os usuários.")}finally{c(!1)}},y=a=>{const r=a.target.value;r&&b(r)};return t&&!n?e.jsx(g,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(p,{})}):u&&l.length===0?e.jsxs(g,{sx:{p:2,textAlign:"center"},children:[e.jsx(j,{severity:"warning",children:u}),e.jsx(C,{variant:"contained",onClick:()=>O(-1),sx:{mt:2},children:"Voltar"})]}):e.jsxs(g,{children:[e.jsxs(I,{fullWidth:!0,sx:{mb:2},children:[e.jsx(N,{id:"org-select-label",children:"Selecione uma Organização"}),e.jsx(T,{labelId:"org-select-label",value:n?.id||"",label:"Selecione uma Organização",onChange:y,children:l.map(a=>e.jsx(A,{value:a.id,children:a.name},a.id))})]}),t&&n&&e.jsx(g,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(p,{})}),u&&e.jsx(j,{severity:"error",children:u}),n&&!t&&e.jsx(B,{users:h,organization:n}),!n&&!t&&l.length>0&&e.jsx(E,{variant:"body1",sx:{p:2,textAlign:"center"},children:"Por favor, selecione uma organização para ver os usuários."})]})},k=()=>e.jsx(L,{title:"Gerenciador de Usuários da Organização",children:e.jsx(G,{})});export{k as default};
