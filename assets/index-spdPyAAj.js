import{j as o,L as p,p as E,e as t,l as I,g as w,D as F,C as S,r as d,B as L,s as A,q as D}from"./index-Cw1vh47c.js";import{T as b}from"./ToolPageLayout-B48a5b2y.js";const N=()=>o.jsxs(o.Fragment,{children:[o.jsx(p,{name:"name",label:"Nome",formField:!0,required:!0}),o.jsx(p,{name:"abbreviation",label:"Abreviação",formField:!0,required:!0})]}),q=()=>o.jsx(N,{}),M=r=>{const f={};return r.name||(f.name="O nome é obrigatório"),r.abbreviation||(f.abbreviation="A abreviação é obrigatória"),f},T=()=>{const{organizationData:r,isLoading:f}=E(),[m,g]=t.useState([]),[P,u]=t.useState(!0),[x,v]=t.useState(null),{showConfirmation:h,showAlert:l}=I(),n=t.useMemo(()=>r?.id?w.getRepository(`organization/${r.id}/profile`,F.Firestore,S.NoCache):null,[r?.id]),c=t.useCallback(async()=>{if(!r?.id||!n){u(!1);return}u(!0),v(null);try{const e=await n.getAll({sort:{field:"name",direction:"asc"}});g(e)}catch(e){d.error("Error fetching profiles",{error:e,organizationId:r.id}),v("Falha ao carregar perfis. Por favor, tente novamente mais tarde.")}finally{u(!1)}},[n,r?.id]);t.useEffect(()=>{c()},[c]);const y=t.useMemo(()=>[{field:"id",headerName:"ID",width:200},{field:"name",headerName:"Nome",width:250},{field:"abbreviation",headerName:"Abreviação",width:150}],[]),z=t.useMemo(()=>m.map(e=>({id:e.id,name:e.name||"",abbreviation:e.abbreviation||"",_original:e})),[m]),j=t.useCallback(async(e,a)=>{if(!r?.id||!n){l({title:"Erro",message:"Organização não encontrada."});return}try{if(a){const i=await n.create({name:e.name,abbreviation:e.abbreviation});g(s=>[...s,i]),d.info("Perfil criado",{profileId:i.id,organizationId:r.id,name:e.name,abbreviation:e.abbreviation})}else{if(!e.id){l({title:"Erro",message:"ID do perfil não encontrado."});return}await n.update(e.id,{name:e.name,abbreviation:e.abbreviation}),g(i=>i.map(s=>s.id===e.id?{...s,name:e.name,abbreviation:e.abbreviation}:s)),d.info("Perfil alterado",{profileId:e.id,organizationId:r.id,name:e.name,abbreviation:e.abbreviation})}c()}catch(i){d.error("Error saving profile",{error:i,isNew:a,profileId:e.id,organizationId:r.id,name:e.name});const s=i instanceof Error?i.message:"Falha ao salvar o perfil.";l({title:"Erro",message:s})}},[r?.id,n,l,c]),C=t.useCallback(e=>{const a=e._original||m.find(i=>i.id===e.id);!a||!r||!n||h({title:"Confirmar Remoção",message:`Tem certeza que deseja remover o perfil "${a.name}"? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{await n.delete(a.id),g(m.filter(i=>i.id!==a.id)),d.info("Perfil removido",{profileId:a.id,organizationId:r.id,name:a.name})}catch(i){d.error("Error removing profile",{error:i,profileId:a.id,organizationId:r.id,name:a.name}),l({title:"Erro",message:"Falha ao remover perfil. Por favor, tente novamente mais tarde."})}}})},[m,r,n,h,l]);return f?o.jsx(b,{title:"Gerenciador de Perfis",children:o.jsx(L,{sx:{display:"flex",justifyContent:"center",p:4},children:"Carregando organização..."})}):r?o.jsx(b,{title:`Gerenciador de Perfis - ${r.name}`,children:o.jsx(D,{title:"Perfis da Organização",rows:z,columns:y,loading:P,error:x,initialValues:{id:"",name:"",abbreviation:""},dialogTitle:"Perfil",onSave:j,onDelete:C,onRefresh:c,onValidate:M,hideAddButton:!1,children:q()})}):o.jsx(b,{title:"Gerenciador de Perfis",children:o.jsx(A,{severity:"warning",children:"Nenhuma organização selecionada. Por favor, selecione uma organização para gerenciar os perfis."})})};export{T as default};
