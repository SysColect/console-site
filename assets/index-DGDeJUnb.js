import{j as e,D as w,h as C,as as T,r as o,ay as A,az as E,aA as b,$ as d,B as m,o as y,p as z,a as I,aB as N,aC as R,aD as B,U as L,T as P}from"./index-BTPhf6Rc.js";import{T as G}from"./ToolPageLayout-D6VjKgRe.js";const M=({users:i,organization:h})=>{const n=[{field:"name",headerName:"Nome",flex:1},{field:"email",headerName:"Email",flex:1},{field:"role",headerName:"Role",flex:1,valueGetter:r=>r.row.role||"user"},{field:"inactivationDate",headerName:"Data Inativação",flex:1,valueGetter:r=>{const s=T(r.value);return s?s.toLocaleDateString():"-"}}],x=(r,s)=>{console.log("Save",r,s)},f=r=>{console.log("Delete",r)},v=[{label:"User",value:"user"},{label:"Supervisor",value:"supervisor"},{label:"Admin",value:"admin"}];return e.jsx(w,{title:`Usuários em ${h.name}`,rows:i,columns:n,onSave:x,onDelete:f,initialValues:{role:"user",inactivationDate:null},dialogTitle:"Editar Vínculo do Usuário",hideAddButton:!0,children:e.jsx(C,{name:"role",label:"Role",options:v})})},V=()=>{const[i,h]=o.useState([]),[n,x]=o.useState(null),[f,v]=o.useState([]),[r,s]=o.useState(!0),[u,g]=o.useState(null),U=A(),j=o.useCallback(async()=>{try{s(!0);const a=E.currentUser;if(!a)throw new Error("Usuário não autenticado.");const t=await b.getUserData(a.uid);let l=[];if(t?.adminConsole)l=await d.getAllOrganizations();else{const O=(await d.getUserOrganizationRoles(a.uid)).filter(c=>c.role==="admin").map(c=>c.organizationId);if(O.length>0){const c=O.map(p=>d.getOrganization(p));l=(await Promise.all(c)).filter(p=>p!==null)}}h(l),l.length===0&&g("Você não tem permissão para gerenciar usuários de nenhuma organização.")}catch(a){g(a.message||"Ocorreu um erro ao buscar as organizações.")}finally{s(!1)}},[]);o.useEffect(()=>{j()},[j]);const S=async a=>{try{s(!0),g(null);const t=await d.getOrganization(a);if(x(t),t){const l=await b.getUsersInOrganization(a);v(l)}}catch(t){g(t.message||"Ocorreu um erro ao buscar os usuários.")}finally{s(!1)}},D=a=>{const t=a.target.value;t&&S(t)};return r&&!n?e.jsx(m,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(y,{})}):u&&i.length===0?e.jsxs(m,{sx:{p:2,textAlign:"center"},children:[e.jsx(z,{severity:"warning",children:u}),e.jsx(I,{variant:"contained",onClick:()=>U(-1),sx:{mt:2},children:"Voltar"})]}):e.jsxs(m,{children:[e.jsxs(N,{fullWidth:!0,sx:{mb:2},children:[e.jsx(R,{id:"org-select-label",children:"Selecione uma Organização"}),e.jsx(B,{labelId:"org-select-label",value:n?.id||"",label:"Selecione uma Organização",onChange:D,children:i.map(a=>e.jsx(L,{value:a.id,children:a.name},a.id))})]}),r&&n&&e.jsx(m,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(y,{})}),u&&e.jsx(z,{severity:"error",children:u}),n&&!r&&e.jsx(M,{users:f,organization:n}),!n&&!r&&i.length>0&&e.jsx(P,{variant:"body1",sx:{p:2,textAlign:"center"},children:"Por favor, selecione uma organização para ver os usuários."})]})},q=()=>e.jsx(G,{title:"Gerenciador de Usuários da Organização",children:e.jsx(V,{})});export{q as default};
