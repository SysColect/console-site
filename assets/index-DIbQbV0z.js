import{j as t,d as f,av as F,Y as z,r,b as N,D as S,as as p,E as x}from"./index-BTPhf6Rc.js";import{T as L}from"./ToolPageLayout-D6VjKgRe.js";import{F as C,R,N as A}from"./firestore.source-YeBl6uHF.js";const M=n=>t.jsxs(t.Fragment,{children:[t.jsx(f,{name:"name",label:"Nome",formField:!0}),t.jsx(f,{name:"abbreviation",label:"Abreviação",formField:!0}),t.jsx(F,{name:"holding",label:"Holding",optionsMap:n,formField:!0}),t.jsx(f,{name:"inactivationDate",label:"Data de Inativação",type:"date",formField:!0}),t.jsx(f,{name:"inclusionDate",label:"Data de Inclusão",type:"date",formField:!0,disabled:!0})]}),T=n=>{const o={};return o.name=z.required("O nome da organização é obrigatório")(n.name),o.abbreviation=z.required("A abreviação é obrigatória")(n.abbreviation),Object.entries(o).reduce((l,[h,g])=>(g&&(l[h]=g),l),{})},I=()=>{const[n,o]=r.useState([]),[l,h]=r.useState({}),[g,v]=r.useState(!0),[w,D]=r.useState(null),{showConfirmation:O,showAlert:b}=N(),d=r.useMemo(()=>{const e=new C("organization"),i=new A;return new R(e,i)},[]),c=r.useCallback(async()=>{v(!0),D(null);try{const e=await d.getAll({sort:{field:"name",direction:"asc"}});o(e);const i=e.reduce((a,s)=>(a[s.id]=s.name,a),{});h(i)}catch(e){console.error("Error fetching organizations:",e),D("Falha ao carregar as organizações. Por favor, tente novamente mais tarde.")}finally{v(!1)}},[d]);r.useEffect(()=>{c()},[c]);const j=[{field:"name",headerName:"Nome",width:250},{field:"abbreviation",headerName:"Abreviação",width:120},{field:"holding",headerName:"Holding",width:250,valueGetter:e=>l[e]||"-"},{field:"inclusionDate",headerName:"Data de Inclusão",width:180,valueGetter:e=>p(e)?.toLocaleDateString("pt-BR")||"-"},{field:"inactivationDate",headerName:"Data de Inativação",width:180,valueGetter:e=>e?p(e)?.toLocaleDateString("pt-BR"):"-"},{field:"id",headerName:"ID",flex:1}],y=async(e,i)=>{const a={...e},s=a.id;delete a.id,(a.holding===""||a.holding===void 0)&&(a.holding=null),a.inactivationDate=a.inactivationDate?x.fromDate(new Date(a.inactivationDate)):null;try{if(i){a.inclusionDate=x.now();const u=await d.create(a);o(m=>[...m,u])}else delete a.inclusionDate,await d.update(s,a),o(u=>u.map(m=>m.id===s?{...m,...a,id:s}:m));c()}catch(u){console.error("Error saving organization:",u),b({title:"Erro",message:"Falha ao salvar a organização."})}},E=e=>{O({title:"Confirmar Exclusão",message:`Você tem certeza que deseja excluir a organização ${e.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{await d.delete(e.id),o(n.filter(i=>i.id!==e.id)),c()}catch(i){console.error("Error deleting organization:",i),b({title:"Erro",message:"Falha ao excluir a organização. Por favor, tente novamente mais tarde."})}}})};return t.jsx(S,{title:"Organizações",rows:n,columns:j,loading:g,error:w,initialValues:{name:"",abbreviation:"",holding:null,inactivationDate:null,inclusionDate:null},dialogTitle:"Organização",onSave:y,onDelete:E,onRefresh:c,onValidate:T,hideAddButton:!1,children:M(l)})},B=()=>t.jsx(L,{title:"Gerenciador de Organizações",children:t.jsx(I,{})});export{B as default};
