import{r as i,g as W,ao as z,j as e,D as H,a as L,b as q,A as B,T as b,h as Q,i as O,k as A,l as F,s as G,z as E,m as P,ap as V,Q as X,n as $,B as M,C as J,P as K,I as U,o as Y,M as N,p as Z}from"./index-s15rESzp.js";import{M as _}from"./MoreVert-3NC8a17u.js";import{T as ee}from"./ToolPageLayout-DkLl636-.js";import{T as te,a as ae,b as ne,c as R,d as u,e as ie}from"./TableRow-CPBR3qYy.js";const se=({open:h,onClose:r,organization:a})=>{const[m,g]=i.useState(""),[x,f]=i.useState(""),[C,l]=i.useState(null),[c,S]=i.useState(null),[D,j]=i.useState(void 0),[w,y]=i.useState(""),[T,v]=i.useState(null),d=W();i.useEffect(()=>{const n=async s=>{const t=A(d,"organization",s),o=await F(t);o.exists()&&y(o.data().name)};a?(g(a.name||""),f(a.abbreviation||""),l(z(a.inclusionDate)),S(z(a.inactivationDate)),j(a.holding),a.holding?n(a.holding):y("")):(g(""),f(""),l(null),S(null),j(void 0),y(""))},[a,d]);const I=async()=>{if(v(null),!m||!x){v("Please fill in all required fields.");return}try{if(a){const n=A(d,"organization",a.id),s=await F(n),t={name:m,abbreviation:x,inactivationDate:c,holding:D};(!s.exists()||!s.data()?.inclusionDate)&&(t.inclusionDate=new Date),await G(n,t,{merge:!0}),r({...a,...t,inclusionDate:t.inclusionDate?E.fromDate(t.inclusionDate):a.inclusionDate,inactivationDate:c?E.fromDate(c):void 0})}else{const n=P(d,"organization"),s={name:m,abbreviation:x,inclusionDate:new Date,inactivationDate:c,holding:D},t=await V(n,s);r({id:t.id,...s,inclusionDate:E.fromDate(s.inclusionDate),inactivationDate:s.inactivationDate?E.fromDate(s.inactivationDate):void 0})}}catch(n){n instanceof Error?v(n.message):v("An unexpected error occurred."),console.error("Error saving organization:",n)}};return e.jsxs(H,{open:h,onClose:()=>r(),children:[e.jsx(L,{children:a?"Edit Organization":"Add Organization"}),e.jsxs(q,{children:[T&&e.jsx(B,{severity:"error",sx:{mb:2},children:T}),a&&e.jsx(b,{autoFocus:!0,margin:"dense",id:"id",label:"Organization ID",type:"text",fullWidth:!0,disabled:!0,value:a?.id||""}),e.jsx(b,{margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,value:m,onChange:n=>g(n.target.value)}),e.jsx(b,{margin:"dense",id:"abbreviation",label:"Abbreviation",type:"text",fullWidth:!0,value:x,onChange:n=>f(n.target.value)}),e.jsx(b,{margin:"dense",id:"holding",label:"Holding",type:"text",fullWidth:!0,disabled:!0,value:w}),e.jsx(b,{margin:"dense",id:"inclusionDate",label:"Inclusion Date",type:"text",fullWidth:!0,disabled:!0,value:C?C.toLocaleDateString():""}),e.jsx(b,{margin:"dense",id:"inactivationDate",label:"Inactivation Date",type:"date",fullWidth:!0,value:c?c.toISOString().split("T")[0]:"",onChange:n=>S(new Date(n.target.value)),InputLabelProps:{shrink:!0}})]}),e.jsxs(Q,{children:[e.jsx(O,{onClick:()=>r(),children:"Cancel"}),e.jsx(O,{onClick:I,children:"Save"})]})]})},de=()=>{const[h,r]=i.useState([]),[a,m]=i.useState(!0),[g,x]=i.useState(null),[f,C]=i.useState(null),[l,c]=i.useState(null),[S,D]=i.useState(!1),j=W(),{showConfirmation:w,showAlert:y}=X(),T=i.useCallback(async()=>{m(!0),x(null);try{const t=P(j,"organization"),p=(await $(t)).docs.map(k=>({id:k.id,...k.data()}));r(p)}catch(t){console.error("Error fetching organizations:",t),x("Falha ao carregar organizações. Tente novamente mais tarde.")}finally{m(!1)}},[j]);i.useEffect(()=>{T()},[T]);const v=(t,o)=>{C(t.currentTarget),c(o)},d=()=>{C(null)},I=()=>{D(!0),d()},n=()=>{d(),l&&w({title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir a organização ${l.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{if(!l)return;const t=A(j,"organization",l.id);await Z(t),r(h.filter(o=>o.id!==l.id))}catch(t){console.error("Error deleting organization:",t),y({title:"Erro",message:"Falha ao excluir organização. Tente novamente mais tarde."})}}})},s=()=>{c(null),D(!0)};return e.jsx(ee,{title:"Gerenciador de Organizações",actions:e.jsx(O,{variant:"contained",color:"secondary",onClick:s,children:"Incluir Organização"}),children:a?e.jsx(M,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(J,{})}):g?e.jsx(B,{severity:"error",children:g}):e.jsxs(M,{sx:{width:"100%",overflowX:"auto"},children:[e.jsx(te,{component:K,children:e.jsxs(ae,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(ne,{children:e.jsxs(R,{children:[e.jsx(u,{children:"ID da Organização"}),e.jsx(u,{children:"Nome"}),e.jsx(u,{children:"Abreviação"}),e.jsx(u,{children:"Ações"})]})}),e.jsx(ie,{children:h.map(t=>e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(u,{component:"th",scope:"row",children:t.id}),e.jsx(u,{children:t.name||"N/A"}),e.jsx(u,{children:t.abbreviation||"N/A"}),e.jsx(u,{children:e.jsx(U,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:o=>v(o,t),children:e.jsx(_,{})})})]},t.id))})]})}),e.jsxs(Y,{id:"long-menu",anchorEl:f,open:!!f,onClose:d,children:[e.jsx(N,{onClick:I,children:"Editar"}),e.jsx(N,{onClick:n,children:"Excluir"})]}),e.jsx(se,{open:S,onClose:t=>{if(t){const o=h.find(p=>p.id===t.id);r(o?h.map(p=>p.id===t.id?t:p):[t,...h])}D(!1)},organization:l})]})})};export{de as default};
