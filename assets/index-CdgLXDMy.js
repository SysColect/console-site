import{r as s,g as F,a0 as A,j as e,D as L,a as N,b as q,A as M,T as C,h as _,i as w,k as R,z as G,s as H,E as y,l as B,a1 as V,u as X,m as $,B as z,C as J,P as K,I as Q,n as U,M as I,o as Y}from"./index-BGco_TcG.js";import{M as Z}from"./MoreVert-D_hbpoZ5.js";import{T as ee}from"./ToolPageLayout-DQ29UEM7.js";import{T as ae,a as te,b as ne,c as k,d as h,e as se}from"./TableRow-Bz7GuFdg.js";const ie=({open:x,onClose:o,organization:n})=>{const[m,g]=s.useState(""),[f,D]=s.useState(""),[b,r]=s.useState(null),[l,p]=s.useState(null),[j,d]=s.useState(null),S=F();s.useEffect(()=>{n?(g(n.name||""),D(n.abbreviation||""),r(A(n.inclusionDate)),p(A(n.inactivationDate))):(g(""),D(""),r(null),p(null))},[n]);const E=async()=>{if(d(null),!m||!f){d("Please fill in all required fields.");return}try{if(n){const t=R(S,"organization",n.id),i=await G(t),c={name:m,abbreviation:f,inactivationDate:l};(!i.exists()||!i.data()?.inclusionDate)&&(c.inclusionDate=new Date),await H(t,c,{merge:!0}),o({...n,...c,inclusionDate:c.inclusionDate?y.fromDate(c.inclusionDate):n.inclusionDate,inactivationDate:l?y.fromDate(l):void 0})}else{const t=B(S,"organization"),i={name:m,abbreviation:f,inclusionDate:new Date,inactivationDate:l},c=await V(t,i);o({id:c.id,...i,inclusionDate:y.fromDate(i.inclusionDate),inactivationDate:i.inactivationDate?y.fromDate(i.inactivationDate):void 0})}}catch(t){t instanceof Error?d(t.message):d("An unexpected error occurred."),console.error("Error saving organization:",t)}},T=(t,i)=>{o()};return e.jsxs(L,{open:x,onClose:T,children:[e.jsx(N,{children:n?"Edit Organization":"Add Organization"}),e.jsxs(q,{children:[j&&e.jsx(M,{severity:"error",sx:{mb:2},children:j}),n&&e.jsx(C,{autoFocus:!0,margin:"dense",id:"id",label:"Organization ID",type:"text",fullWidth:!0,disabled:!0,value:n?.id||""}),e.jsx(C,{margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,value:m,onChange:t=>g(t.target.value)}),e.jsx(C,{margin:"dense",id:"abbreviation",label:"Abbreviation",type:"text",fullWidth:!0,value:f,onChange:t=>D(t.target.value)}),e.jsx(C,{margin:"dense",id:"inclusionDate",label:"Inclusion Date",type:"text",fullWidth:!0,disabled:!0,value:b?b.toLocaleDateString():""}),e.jsx(C,{margin:"dense",id:"inactivationDate",label:"Inactivation Date",type:"date",fullWidth:!0,value:l?l.toISOString().split("T")[0]:"",onChange:t=>p(new Date(t.target.value)),InputLabelProps:{shrink:!0}})]}),e.jsxs(_,{children:[e.jsx(w,{onClick:()=>o(),children:"Cancel"}),e.jsx(w,{onClick:E,children:"Save"})]})]})},de=()=>{const[x,o]=s.useState([]),[n,m]=s.useState(!0),[g,f]=s.useState(null),[D,b]=s.useState(null),[r,l]=s.useState(null),[p,j]=s.useState(!1),d=F(),{showConfirmation:S,showAlert:E}=X(),T=s.useCallback(async()=>{m(!0),f(null);try{const a=B(d,"organization"),v=(await $(a)).docs.map(O=>({id:O.id,...O.data()}));o(v)}catch(a){console.error("Error fetching organizations:",a),f("Falha ao carregar organizações. Tente novamente mais tarde.")}finally{m(!1)}},[d]);s.useEffect(()=>{T()},[T]);const t=(a,u)=>{b(a.currentTarget),l(u)},i=()=>{b(null)},c=()=>{j(!0),i()},P=()=>{i(),r&&S({title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir a organização ${r.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{if(!r)return;const a=R(d,"organization",r.id);await Y(a),o(x.filter(u=>u.id!==r.id))}catch(a){console.error("Error deleting organization:",a),E({title:"Erro",message:"Falha ao excluir organização. Tente novamente mais tarde."})}}})},W=()=>{l(null),j(!0)};return e.jsx(ee,{title:"Gerenciador de Organizações",actions:e.jsx(w,{variant:"contained",color:"secondary",onClick:W,children:"Incluir Organização"}),children:n?e.jsx(z,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(J,{})}):g?e.jsx(M,{severity:"error",children:g}):e.jsxs(z,{sx:{width:"100%",overflowX:"auto"},children:[e.jsx(ae,{component:K,children:e.jsxs(te,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(ne,{children:e.jsxs(k,{children:[e.jsx(h,{children:"ID da Organização"}),e.jsx(h,{children:"Nome"}),e.jsx(h,{children:"Abreviação"}),e.jsx(h,{children:"Ações"})]})}),e.jsx(se,{children:x.map(a=>e.jsxs(k,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(h,{component:"th",scope:"row",children:a.id}),e.jsx(h,{children:a.name||"N/A"}),e.jsx(h,{children:a.abbreviation||"N/A"}),e.jsx(h,{children:e.jsx(Q,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:u=>t(u,a),children:e.jsx(Z,{})})})]},a.id))})]})}),e.jsxs(U,{id:"long-menu",anchorEl:D,open:!!D,onClose:i,children:[e.jsx(I,{onClick:c,children:"Editar"}),e.jsx(I,{onClick:P,children:"Excluir"})]}),e.jsx(ie,{open:p,onClose:a=>{if(a){const u=x.find(v=>v.id===a.id);o(u?x.map(v=>v.id===a.id?a:v):[a,...x])}j(!1)},organization:r})]})})};export{de as default};
