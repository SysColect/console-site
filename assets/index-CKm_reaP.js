import{r as o,g as B,j as e,X as C,k as q,C as w,A as g,B as E,y as U,P as A,Y as F,n as P,Z as R,$ as D,a0 as I,p as $}from"./index-DYHoXdso.js";import{T as k}from"./ToolPageLayout-B0UWFUD6.js";import{T as M,a as N,b as O,c as j,d as r,e as V}from"./TableRow-BXVGgdlF.js";const Y=()=>{const[d,u]=o.useState([]),[h,m]=o.useState(!1),[x,p]=o.useState(null),[f,n]=o.useState(!0),[t,y]=o.useState(null),i=B();o.useEffect(()=>{(async()=>{if(t){m(!0),p(null),u([]);try{const l=P(i,"consoleLogs"),T=R(l,D("userId","==",t.id),I("timestamp","desc")),L=(await $(T)).docs.flatMap(c=>{const a=c.data();return a.events&&Array.isArray(a.events)?a.events.map((b,v)=>({...b,id:`${c.id}-${v}`,url:a.url,userId:a.userId,timestamp:a.timestamp})):{...a,id:c.id}});u(L)}catch(l){console.error("Error fetching logs:",l),p("Failed to fetch logs.")}finally{m(!1)}}})()},[t,i]);const S=(s,l)=>{y({...l,id:s}),n(!1)};return e.jsxs(k,{title:"Visualizador de Logs",children:[e.jsx(C,{open:f,onClose:()=>n(!1),onSelect:S,collectionName:"user",headerText:"Selecionar Usuário",searchField:"email",displayFields:{primary:"name",secondary:"email"},db:i}),t&&e.jsx(q,{onClick:()=>n(!0),children:"Buscar outro usuário"}),h&&e.jsx(w,{}),x&&e.jsx(g,{severity:"warning",sx:{mt:2},children:x}),d.length>0?e.jsxs(E,{children:[e.jsxs(U,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:["Logs para: ",t?.email," (",t?.name,")"]}),e.jsx(M,{component:A,children:e.jsxs(N,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(O,{children:e.jsxs(j,{children:[e.jsx(r,{children:"Timestamp"}),e.jsx(r,{children:"Level"}),e.jsx(r,{children:"Message"}),e.jsx(r,{children:"URL"})]})}),e.jsx(V,{children:d.map(s=>e.jsxs(j,{children:[e.jsx(r,{children:F(s.timestamp)?.toLocaleString()}),e.jsx(r,{children:s.level}),e.jsx(r,{children:s.message}),e.jsx(r,{children:s.url})]},s.id))})]})})]}):!h&&t&&e.jsx(g,{severity:"info",children:"Nenhum log encontrado para este usuário."})]})};export{Y as default};
