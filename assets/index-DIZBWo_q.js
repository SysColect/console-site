import{c as U,j as e,r as o,D as B,a as O,b as N,T as v,G as M,L as V,d as q,e as X,g as z,A as $,B as A,I as H,F as J,f as K,S as Y,M as L,h as Z,i as W,k as D,l as _,m as Q,s as ee,Q as te,n as se,C as oe,P as re,o as ne,p as ae}from"./index-s15rESzp.js";import{M as le}from"./MoreVert-3NC8a17u.js";import{T as ie}from"./ToolPageLayout-DkLl636-.js";import{T as ce,a as de,b as ue,c as R,d as m,e as he}from"./TableRow-CPBR3qYy.js";const xe=U(e.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),me=({open:i,onClose:c})=>{const[r,u]=o.useState(""),[d,f]=o.useState({});o.useEffect(()=>{i&&fetch("/icons.sanitized.json").then(n=>n.json()).then(n=>f(n))},[i]);const h=o.useMemo(()=>Object.keys(d).filter(n=>{const a=r.toLowerCase(),j=d[n].search;return n.toLowerCase().includes(a)||j.some(p=>p.toLowerCase().includes(a))}),[d,r]);return e.jsxs(B,{open:i,onClose:()=>c(null),fullWidth:!0,maxWidth:"md",children:[e.jsx(O,{children:"Select an Icon"}),e.jsxs(N,{children:[e.jsx(v,{autoFocus:!0,margin:"dense",id:"search",label:"Search Icons",type:"text",fullWidth:!0,variant:"standard",value:r,onChange:n=>u(n.target.value)}),e.jsx(M,{container:!0,spacing:2,sx:{mt:2},children:h.map(n=>e.jsx(M,{item:!0,xs:3,children:e.jsxs(V,{onClick:()=>c(n),children:[e.jsx(q,{children:e.jsx("i",{className:`fa-solid fa-${n}`})}),e.jsx(X,{primary:n})]})},n))})]})]})},fe=({open:i,onClose:c,tool:r})=>{const[u,d]=o.useState(""),[f,h]=o.useState(""),[n,a]=o.useState("redirect"),[j,p]=o.useState(""),[T,x]=o.useState(""),[F,b]=o.useState(!1),[E,k]=o.useState(void 0),[S,y]=o.useState(""),[w,I]=o.useState(null),C=z();o.useEffect(()=>{const t=async l=>{const g=D(C,"consoleToolGroups",l),P=await _(g);P.exists()&&y(P.data().name)};r?(d(r.name||""),h(r.description||""),a(r.action||"redirect"),p(r.actionProperties?.redirectTo||""),x(r.icon||""),k(r.toolGroup),r.toolGroup?t(r.toolGroup):y("")):(d(""),h(""),a("redirect"),p(""),x(""),k(void 0),y(""))},[r,C]);const G=async()=>{if(I(null),!u){I("Name is required.");return}const t={name:u,description:f,action:n,actionProperties:{redirectTo:j},icon:T,toolGroup:E};try{const l={...r,...t},g=r?D(C,"consoleTool",r.id):D(Q(C,"consoleTool"));await ee(g,t,{merge:!0}),c({...l,id:g.id})}catch(l){console.error("Error saving tool:",l),I("Failed to save tool.")}},s=t=>{t&&x(t),b(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{open:i,onClose:()=>c(),fullWidth:!0,maxWidth:"sm",children:[e.jsx(O,{children:r?"Edit Tool":"Add Tool"}),e.jsxs(N,{children:[w&&e.jsx($,{severity:"error",sx:{mb:2},children:w}),e.jsx(v,{autoFocus:!0,margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,variant:"standard",value:u,onChange:t=>d(t.target.value)}),e.jsx(v,{margin:"dense",id:"description",label:"Description",type:"text",fullWidth:!0,multiline:!0,rows:3,variant:"standard",value:f,onChange:t=>h(t.target.value)}),e.jsxs(A,{sx:{display:"flex",alignItems:"flex-end"},children:[e.jsx(v,{margin:"dense",id:"icon",label:"Icon",type:"text",fullWidth:!0,variant:"standard",value:T,onChange:t=>x(t.target.value),helperText:"Use the name of a Font Awesome icon (e.g., 'home', 'gear')."}),e.jsx(H,{onClick:()=>b(!0),children:e.jsx(xe,{})})]}),e.jsx(v,{margin:"dense",id:"toolGroup",label:"Tool Group",type:"text",fullWidth:!0,disabled:!0,value:S}),e.jsxs(J,{fullWidth:!0,margin:"dense",children:[e.jsx(K,{id:"action-label",children:"Action"}),e.jsx(Y,{labelId:"action-label",id:"action",value:n,label:"Action",onChange:t=>a(t.target.value),children:e.jsx(L,{value:"redirect",children:"redirect"})})]}),n==="redirect"&&e.jsx(v,{margin:"dense",id:"redirectTo",label:"Redirect Path",type:"text",fullWidth:!0,variant:"standard",value:j,onChange:t=>p(t.target.value),helperText:"E.g., /tools/my-custom-tool"})]}),e.jsxs(Z,{children:[e.jsx(W,{onClick:()=>c(),children:"Cancel"}),e.jsx(W,{onClick:G,children:"Save"})]})]}),e.jsx(me,{open:F,onClose:s})]})},Ce=()=>{const[i,c]=o.useState([]),[r,u]=o.useState(!0),[d,f]=o.useState(null),[h,n]=o.useState(null),[a,j]=o.useState(null),[p,T]=o.useState(!1),x=z(),{showConfirmation:F,showAlert:b}=te(),E=o.useCallback(async()=>{u(!0),f(null);try{const s=Q(x,"consoleTool"),l=(await se(s)).docs.map(g=>({id:g.id,...g.data()}));c(l)}catch(s){console.error("Error fetching tools:",s),f("Failed to load tools. Please try again later.")}finally{u(!1)}},[x]);o.useEffect(()=>{E()},[E]);const k=(s,t)=>{n(s.currentTarget),j(t)},S=()=>{n(null)},y=()=>{j(null),T(!0)},w=()=>{T(!0),S()},I=()=>{S(),a&&F({title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir a ferramenta ${a.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{if(!a)return;const s=D(x,"consoleTool",a.id);await ae(s),c(i.filter(t=>t.id!==a.id))}catch(s){console.error("Error deleting tool:",s),b({title:"Erro",message:"Falha ao excluir a ferramenta. Tente novamente mais tarde."})}}})},C=s=>{if(T(!1),s){const t=i.findIndex(l=>l.id===s.id);if(t!==-1){const l=[...i];l[t]=s,c(l)}else c([s,...i])}},G=s=>s?e.jsx("i",{className:`fa-solid fa-${s}`}):null;return e.jsx(ie,{title:"Gerenciador de Ferramentas",actions:e.jsx(W,{variant:"contained",color:"secondary",onClick:y,children:"Incluir Ferramenta"}),children:r?e.jsx(A,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(oe,{})}):d?e.jsx($,{severity:"error",children:d}):e.jsxs(A,{sx:{width:"100%",overflowX:"auto"},children:[e.jsx(ce,{component:re,children:e.jsxs(de,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(ue,{children:e.jsxs(R,{children:[e.jsx(m,{children:"Icon"}),e.jsx(m,{children:"Nome"}),e.jsx(m,{children:"Descrição"}),e.jsx(m,{children:"Ações"})]})}),e.jsx(he,{children:i.map(s=>e.jsxs(R,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(m,{children:e.jsx(q,{children:G(s.icon)})}),e.jsx(m,{component:"th",scope:"row",children:s.name}),e.jsx(m,{children:s.description||"N/A"}),e.jsx(m,{children:e.jsx(H,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:t=>k(t,s),children:e.jsx(le,{})})})]},s.id))})]})}),e.jsxs(ne,{id:"long-menu",anchorEl:h,open:!!h,onClose:S,children:[e.jsx(L,{onClick:w,children:"Editar"}),e.jsx(L,{onClick:I,children:"Excluir"})]}),e.jsx(fe,{open:p,onClose:C,tool:a})]})})};export{Ce as default};
