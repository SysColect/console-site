import{r,j as e,D as U,a as W,b as R,T as k,C as E,x as A,y as O,L as V,e as $,W as S,l as T,X as B,Y as L,Z as C,$ as b,m as I,g as z,i as H,A as q,B as M,w as X,P as Y}from"./index-CYRXvscp.js";import{T as Z}from"./ToolPageLayout-oshJhCXu.js";import{T as G,a as J,b as K,c as w,d as l,e as N}from"./TableRow-CHWf36jP.js";const Q=({open:c,onClose:h,onSelect:g,collectionName:d,headerText:j,searchField:o,displayFields:m})=>{const[n,a]=r.useState(""),[f,x]=r.useState([]),[p,t]=r.useState(!1);r.useEffect(()=>{if(!c){x([]),a("");return}const s=async()=>{t(!0);try{let u=S(T(B,d),L(o),C(50));n&&(u=S(T(B,d),b(o,">=",n),b(o,"<=",n+""),L(o),C(50)));const P=(await I(u)).docs.map(D=>({id:D.id,...D.data()}));x(P)}catch(u){console.error("Error fetching documents: ",u)}finally{t(!1)}},v=setTimeout(()=>{s()},500);return()=>clearTimeout(v)},[n,c,d,o]);const i=s=>{g(s.id,s),h()};return e.jsxs(U,{open:c,onClose:h,fullWidth:!0,maxWidth:"sm",children:[e.jsx(W,{children:j}),e.jsxs(R,{children:[e.jsx(k,{autoFocus:!0,margin:"dense",label:`Search by ${o}`,type:"text",fullWidth:!0,variant:"standard",value:n,onChange:s=>a(s.target.value)}),p?e.jsx(E,{}):e.jsx(A,{children:f.map(s=>e.jsx(O,{disablePadding:!0,children:e.jsx(V,{onClick:()=>i(s),children:e.jsx($,{primary:s[m.primary],secondary:m.secondary?s[m.secondary]:void 0})})},s.id))})]})]})},se=()=>{const[c,h]=r.useState([]),[g,d]=r.useState(!1),[j,o]=r.useState(null),[m,n]=r.useState(!0),[a,f]=r.useState(null),x=z();r.useEffect(()=>{(async()=>{if(a){d(!0),o(null),h([]);try{const i=T(x,"consoleLogs"),s=S(i,b("userId","==",a.id),L("timestamp","desc")),u=(await I(s)).docs.map(y=>({id:y.id,...y.data()}));h(u)}catch(i){console.error("Error fetching logs:",i),o("Failed to fetch logs.")}finally{d(!1)}}})()},[a,x]);const p=(t,i)=>{f({...i,id:t}),n(!1)};return e.jsxs(Z,{title:"Visualizador de Logs",children:[e.jsx(Q,{open:m,onClose:()=>n(!1),onSelect:p,collectionName:"user",headerText:"Selecionar Usuário",searchField:"email",displayFields:{primary:"name",secondary:"email"}}),a&&e.jsx(H,{onClick:()=>n(!0),children:"Buscar outro usuário"}),g&&e.jsx(E,{}),j&&e.jsx(q,{severity:"warning",sx:{mt:2},children:j}),c.length>0?e.jsxs(M,{children:[e.jsxs(X,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:["Logs para: ",a?.email," (",a?.name,")"]}),e.jsx(G,{component:Y,children:e.jsxs(J,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(K,{children:e.jsxs(w,{children:[e.jsx(l,{children:"Timestamp"}),e.jsx(l,{children:"Level"}),e.jsx(l,{children:"Message"}),e.jsx(l,{children:"URL"})]})}),e.jsx(N,{children:c.map(t=>e.jsxs(w,{children:[e.jsx(l,{children:t.timestamp?.toDate().toLocaleString()}),e.jsx(l,{children:t.level}),e.jsx(l,{children:t.message}),e.jsx(l,{children:t.url})]},t.id))})]})})]}):!g&&a&&e.jsx(q,{severity:"info",children:"Nenhum log encontrado para este usuário."})]})};export{se as default};
