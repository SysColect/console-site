import{j as t,O as f,as as E,e as z,r as n,F as S,a as C,D as N,C as L,L as A,E as p}from"./index-BZrIBs07.js";import{T as M}from"./ToolPageLayout-C5UHLxGO.js";import{f as x}from"./dateUtils-BUPt2Fsv.js";const R=o=>t.jsxs(t.Fragment,{children:[t.jsx(f,{name:"name",label:"Nome",formField:!0}),t.jsx(f,{name:"abbreviation",label:"Abreviação",formField:!0}),t.jsx(E,{name:"holding",label:"Holding",optionsMap:o,formField:!0}),t.jsx(f,{name:"inactivationDate",label:"Data de Inativação",type:"date",formField:!0}),t.jsx(f,{name:"inclusionDate",label:"Data de Inclusão",type:"date",formField:!0,disabled:!0})]}),T=o=>{const i={};return i.name=z.required("O nome da organização é obrigatório")(o.name),i.abbreviation=z.required("A abreviação é obrigatória")(o.abbreviation),Object.entries(i).reduce((l,[h,m])=>(m&&(l[h]=m),l),{})},I=()=>{const[o,i]=n.useState([]),[l,h]=n.useState({}),[m,v]=n.useState(!0),[y,D]=n.useState(null),{showConfirmation:O,showAlert:b}=S(),d=n.useMemo(()=>C.getRepository("organization",N.Firestore,L.NoCache),[]),c=n.useCallback(async()=>{v(!0),D(null);try{const e=await d.getAll({sort:{field:"name",direction:"asc"}});i(e);const r=e.reduce((a,s)=>(a[s.id]=s.name,a),{});h(r)}catch(e){console.error("Error fetching organizations:",e),D("Falha ao carregar as organizações. Por favor, tente novamente mais tarde.")}finally{v(!1)}},[d]);n.useEffect(()=>{c()},[c]);const F=[{field:"name",headerName:"Nome",width:250},{field:"abbreviation",headerName:"Abreviação",width:120},{field:"holding",headerName:"Holding",width:250,valueGetter:e=>l[e]||"-"},{field:"inclusionDate",headerName:"Data de Inclusão",width:180,valueGetter:e=>x(e)?.toLocaleDateString("pt-BR")||"-"},{field:"inactivationDate",headerName:"Data de Inativação",width:180,valueGetter:e=>e?x(e)?.toLocaleDateString("pt-BR"):"-"},{field:"id",headerName:"ID",flex:1}],j=async(e,r)=>{const a={...e},s=a.id;delete a.id,(a.holding===""||a.holding===void 0)&&(a.holding=null),a.inactivationDate=a.inactivationDate?p.fromDate(new Date(a.inactivationDate)):null;try{if(r){a.inclusionDate=p.now();const u=await d.create(a);i(g=>[...g,u])}else delete a.inclusionDate,await d.update(s,a),i(u=>u.map(g=>g.id===s?{...g,...a,id:s}:g));c()}catch(u){console.error("Error saving organization:",u),b({title:"Erro",message:"Falha ao salvar a organização."})}},w=e=>{O({title:"Confirmar Exclusão",message:`Você tem certeza que deseja excluir a organização ${e.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{await d.delete(e.id),i(o.filter(r=>r.id!==e.id)),c()}catch(r){console.error("Error deleting organization:",r),b({title:"Erro",message:"Falha ao excluir a organização. Por favor, tente novamente mais tarde."})}}})};return t.jsx(A,{title:"Organizações",rows:o,columns:F,loading:m,error:y,initialValues:{name:"",abbreviation:"",holding:null,inactivationDate:null,inclusionDate:null},dialogTitle:"Organização",onSave:j,onDelete:w,onRefresh:c,onValidate:T,hideAddButton:!1,children:R(l)})},q=()=>t.jsx(M,{title:"Gerenciador de Organizações",children:t.jsx(I,{})});export{q as default};
