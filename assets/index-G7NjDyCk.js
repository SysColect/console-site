import{a0 as Re,r as l,a1 as Me,j as s,a2 as M,a3 as Fe,a4 as J,a5 as I,a6 as Le,a7 as De,a8 as Ue,a9 as F,aa as L,ab as Ne,ac as X,ad as N,ae as D,af as $e,ag as He,ah as U,ai as K,aj as H,s as de,ak as E,al as ue,am as pe,an as G,ao as fe,ap as Ee,aq as me,u as Pe,ar as Q,as as ze,B as O,a as z,M as Z,e as V,at as Be,I as q,au as Ae,av as Ie,aw as Oe,E as Ve,A as ee,T as te}from"./index-bI3XmyBS.js";import{T as qe}from"./ToolPageLayout-DgX-VRl9.js";import{f as Ge}from"./dateUtils-D90gJyXt.js";const We=Ne(),Ke=Re("div",{name:"MuiStack",slot:"Root"});function _e(e){return Fe({props:e,name:"MuiStack",defaultTheme:We})}function Ye(e,t){const o=l.Children.toArray(e).filter(Boolean);return o.reduce((a,i,r)=>(a.push(i),r<o.length-1&&a.push(l.cloneElement(t,{key:`separator-${r}`})),a),[])}const Je=e=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[e],Xe=({ownerState:e,theme:t})=>{let o={display:"flex",flexDirection:"column",...J({theme:t},I({values:e.direction,breakpoints:t.breakpoints.values}),a=>({flexDirection:a}))};if(e.spacing){const a=Le(t),i=Object.keys(t.breakpoints.values).reduce((n,d)=>((typeof e.spacing=="object"&&e.spacing[d]!=null||typeof e.direction=="object"&&e.direction[d]!=null)&&(n[d]=!0),n),{}),r=I({values:e.direction,base:i}),u=I({values:e.spacing,base:i});typeof r=="object"&&Object.keys(r).forEach((n,d,f)=>{if(!r[n]){const g=d>0?r[f[d-1]]:"column";r[n]=g}}),o=De(o,J({theme:t},u,(n,d)=>e.useFlexGap?{gap:X(a,n)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Je(d?r[d]:e.direction)}`]:X(a,n)}}))}return o=Ue(t.breakpoints,o),o};function Qe(e={}){const{createStyledComponent:t=Ke,useThemeProps:o=_e,componentName:a="MuiStack"}=e,i=()=>F({root:["root"]},n=>L(a,n),{}),r=t(Xe);return l.forwardRef(function(n,d){const f=o(n),y=Me(f),{component:g="div",direction:h="column",spacing:x=0,divider:b,children:m,className:v,useFlexGap:C=!1,...j}=y,w={direction:h,spacing:x,useFlexGap:C},S=i();return s.jsx(r,{as:g,ownerState:w,ref:d,className:M(S.root,v),...j,children:b?Ye(m,b):m})})}function Ze(e){return L("MuiFormGroup",e)}N("MuiFormGroup",["root","row","error"]);const et=e=>{const{classes:t,row:o,error:a}=e;return F({root:["root",o&&"row",a&&"error"]},Ze,t)},tt=U("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),st=l.forwardRef(function(t,o){const a=D({props:t,name:"MuiFormGroup"}),{className:i,row:r=!1,...u}=a,c=$e(),n=He({props:a,muiFormControl:c,states:["error"]}),d={...a,row:r,error:n.error},f=et(d);return s.jsx(tt,{className:M(f.root,i),ownerState:d,ref:o,...u})}),se=Qe({createStyledComponent:U("div",{name:"MuiStack",slot:"Root"}),useThemeProps:e=>D({props:e,name:"MuiStack"})}),ge=l.createContext();function ot(e){return L("MuiTable",e)}N("MuiTable",["root","stickyHeader"]);const at=e=>{const{classes:t,stickyHeader:o}=e;return F({root:["root",o&&"stickyHeader"]},ot,t)},rt=U("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.stickyHeader&&t.stickyHeader]}})(K(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),oe="table",nt=l.forwardRef(function(t,o){const a=D({props:t,name:"MuiTable"}),{className:i,component:r=oe,padding:u="normal",size:c="medium",stickyHeader:n=!1,...d}=a,f={...a,component:r,padding:u,size:c,stickyHeader:n},y=at(f),g=l.useMemo(()=>({padding:u,size:c,stickyHeader:n}),[u,c,n]);return s.jsx(ge.Provider,{value:g,children:s.jsx(rt,{as:r,role:r===oe?null:"table",ref:o,className:M(y.root,i),ownerState:f,...d})})}),B=l.createContext();function lt(e){return L("MuiTableBody",e)}N("MuiTableBody",["root"]);const it=e=>{const{classes:t}=e;return F({root:["root"]},lt,t)},ct=U("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),dt={variant:"body"},ae="tbody",ut=l.forwardRef(function(t,o){const a=D({props:t,name:"MuiTableBody"}),{className:i,component:r=ae,...u}=a,c={...a,component:r},n=it(c);return s.jsx(B.Provider,{value:dt,children:s.jsx(ct,{className:M(n.root,i),as:r,ref:o,role:r===ae?null:"rowgroup",ownerState:c,...u})})});function pt(e){return L("MuiTableCell",e)}const ft=N("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),mt=e=>{const{classes:t,variant:o,align:a,padding:i,size:r,stickyHeader:u}=e,c={root:["root",o,u&&"stickyHeader",a!=="inherit"&&`align${H(a)}`,i!=="normal"&&`padding${H(i)}`,`size${H(r)}`]};return F(c,pt,t)},gt=U("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.variant],t[`size${H(o.size)}`],o.padding!=="normal"&&t[`padding${H(o.padding)}`],o.align!=="inherit"&&t[`align${H(o.align)}`],o.stickyHeader&&t.stickyHeader]}})(K(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${ft.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),R=l.forwardRef(function(t,o){const a=D({props:t,name:"MuiTableCell"}),{align:i="inherit",className:r,component:u,padding:c,scope:n,size:d,sortDirection:f,variant:y,...g}=a,h=l.useContext(ge),x=l.useContext(B),b=x&&x.variant==="head";let m;u?m=u:m=b?"th":"td";let v=n;m==="td"?v=void 0:!v&&b&&(v="col");const C=y||x&&x.variant,j={...a,align:i,component:m,padding:c||(h&&h.padding?h.padding:"normal"),size:d||(h&&h.size?h.size:"medium"),sortDirection:f,stickyHeader:C==="head"&&h&&h.stickyHeader,variant:C},w=mt(j);let S=null;return f&&(S=f==="asc"?"ascending":"descending"),s.jsx(gt,{as:m,ref:o,className:M(w.root,r),"aria-sort":S,scope:v,ownerState:j,...g})});function ht(e){return L("MuiTableContainer",e)}N("MuiTableContainer",["root"]);const yt=e=>{const{classes:t}=e;return F({root:["root"]},ht,t)},xt=U("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),bt=l.forwardRef(function(t,o){const a=D({props:t,name:"MuiTableContainer"}),{className:i,component:r="div",...u}=a,c={...a,component:r},n=yt(c);return s.jsx(xt,{ref:o,as:r,className:M(n.root,i),ownerState:c,...u})});function vt(e){return L("MuiTableHead",e)}N("MuiTableHead",["root"]);const Ct=e=>{const{classes:t}=e;return F({root:["root"]},vt,t)},Tt=U("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),jt={variant:"head"},re="thead",St=l.forwardRef(function(t,o){const a=D({props:t,name:"MuiTableHead"}),{className:i,component:r=re,...u}=a,c={...a,component:r},n=Ct(c);return s.jsx(B.Provider,{value:jt,children:s.jsx(Tt,{as:r,className:M(n.root,i),ref:o,role:r===re?null:"rowgroup",ownerState:c,...u})})});function wt(e){return L("MuiTableRow",e)}const ne=N("MuiTableRow",["root","selected","hover","head","footer"]),kt=e=>{const{classes:t,selected:o,hover:a,head:i,footer:r}=e;return F({root:["root",o&&"selected",a&&"hover",i&&"head",r&&"footer"]},wt,t)},Rt=U("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.head&&t.head,o.footer&&t.footer]}})(K(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${ne.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${ne.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)}}}))),le="tr",ie=l.forwardRef(function(t,o){const a=D({props:t,name:"MuiTableRow"}),{className:i,component:r=le,hover:u=!1,selected:c=!1,...n}=a,d=l.useContext(B),f={...a,component:r,hover:u,selected:c,head:d&&d.variant==="head",footer:d&&d.variant==="footer"},y=kt(f);return s.jsx(Rt,{as:r,ref:o,className:M(y.root,i),role:r===le?null:"row",ownerState:f,...n})}),Mt=de(s.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"})),Ft=de([s.jsx("circle",{cx:"10",cy:"8",r:"4"},"0"),s.jsx("path",{d:"M10.67 13.02c-.22-.01-.44-.02-.67-.02-2.42 0-4.68.67-6.61 1.82-.88.52-1.39 1.5-1.39 2.53V20h9.26c-.79-1.13-1.26-2.51-1.26-4 0-1.07.25-2.07.67-2.98M20.75 16c0-.22-.03-.42-.06-.63l1.14-1.01-1-1.73-1.45.49q-.48-.405-1.08-.63L18 11h-2l-.3 1.49q-.6.225-1.08.63l-1.45-.49-1 1.73 1.14 1.01c-.03.21-.06.41-.06.63s.03.42.06.63l-1.14 1.01 1 1.73 1.45-.49q.48.405 1.08.63L16 21h2l.3-1.49q.6-.225 1.08-.63l1.45.49 1-1.73-1.14-1.01c.03-.21.06-.41.06-.63M17 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"},"1")]);function he(e,t){const[o,a]=l.useState(e);return l.useEffect(()=>{const i=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(i)}},[e,t]),o}const Lt=[],Dt=({open:e,onClose:t,onUserSelect:o,additionalQueryConstraints:a=Lt,dialogHeaderText:i="Selecionar Usuário",searchLabel:r="Buscar por email"})=>{const[u,c]=l.useState([]),[n,d]=l.useState(!1),[f,y]=l.useState(""),g=he(f,500),h=l.useCallback(async b=>{d(!0);try{const m="email",v="user",C=[...a];b&&(C.push(E(m,">=",b)),C.push(E(m,"<=",b+"")));const j=ue(pe(G,v),...C,fe(m),Ee(50)),S=(await me(j)).docs.map(P=>({id:P.id,...P.data()}));c(S)}catch(m){console.error("Error fetching users: ",m)}finally{d(!1)}},[G,a]);l.useEffect(()=>{e&&h(g)},[g,h,e]);const x=b=>{o(b),t()};return s.jsx(Pe,{open:e,loading:n,onClose:t,onSelect:x,headerText:i,searchLabel:r,items:u,itemKey:"id",displayFields:{primary:"name",secondary:"email"},onSearchChange:y})},Ut=(e="")=>e.split(" ").map(a=>a[0]).join("").toUpperCase(),W=["INFO","WARN","ERROR","DEBUG"],ce=W.reduce((e,t)=>({...e,[t]:!0}),{}),Pt=()=>{const[e,t]=l.useState([]),[o,a]=l.useState(!1),[i,r]=l.useState(null),[u,c]=l.useState(!0),[n,d]=l.useState(null),[f,y]=l.useState(null),[g,h]=l.useState(""),[x,b]=l.useState(""),[m,v]=l.useState(ce),[C,j]=l.useState(""),w=he(C,500),S=l.useRef(null);l.useEffect(()=>{const p=T=>{T.ctrlKey&&T.key==="'"&&(T.preventDefault(),c(!0)),T.ctrlKey&&T.shiftKey&&T.key.toLowerCase()==="f"&&(T.preventDefault(),y(S.current))};return document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p)}},[]),l.useEffect(()=>{(async()=>{if(n){a(!0),r(null);try{const T=pe(G,"consoleLogs"),A=[E("userId","==",n.id)];g&&!isNaN(new Date(g).getTime())&&A.push(E("timestamp",">=",te.fromDate(new Date(g)))),x&&!isNaN(new Date(x).getTime())&&A.push(E("timestamp","<=",te.fromDate(new Date(x))));const Te=ue(T,...A,fe("timestamp","desc")),je=(await me(Te)).docs.flatMap(k=>{const $=k.data();return $.events&&Array.isArray($.events)?$.events.map((Y,ke)=>({...Y,id:`${k.id}-${ke}`,url:$.url,userId:$.userId,timestamp:Y.timestamp})):{...$,id:k.id}}),_=Object.keys(m).filter(k=>m[k]),Se=_.length===W.length,we=je.filter(k=>!(!Se&&!_.includes(k.level)||w&&!k.message.toLowerCase().includes(w.toLowerCase())));t(we)}catch(T){console.error("Error fetching logs:",T),r("Failed to fetch logs.")}finally{a(!1)}}})()},[n,g,x,m,w]);const P=p=>{d(p),c(!1)},ye=p=>{v({...m,[p.target.name]:p.target.checked})},xe=()=>{h(""),b(""),v(ce),j("")},be=p=>y(p.currentTarget),ve=()=>y(null),Ce=!!f;return s.jsxs(qe,{title:"Visualizador de Logs",children:[u&&s.jsx(Dt,{open:u,onClose:()=>c(!1),onUserSelect:P}),n&&s.jsxs(Q,{sx:{p:2,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[s.jsxs(se,{direction:"row",spacing:2,alignItems:"center",children:[s.jsx(ze,{sx:{width:56,height:56},children:Ut(n.name)}),s.jsxs(O,{children:[s.jsx(z,{variant:"h5",component:"div",children:n.name}),s.jsx(z,{variant:"body2",color:"text.secondary",children:n.email})]})]}),s.jsxs(se,{direction:"row",spacing:1,alignItems:"center",sx:{mt:{xs:2,md:0}},children:[s.jsx(Z,{title:"Filtros (Ctrl + Shift + F)",children:s.jsx(V,{variant:"outlined",startIcon:s.jsx(Mt,{}),onClick:be,ref:S,children:"Filtros"})}),s.jsx(Be,{open:Ce,anchorEl:f,onClose:ve,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:s.jsxs(O,{sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:300},children:[s.jsx(z,{variant:"subtitle1",children:"Filtros"}),s.jsx(q,{label:"Início",type:"datetime-local",value:g,onChange:p=>h(p.target.value),InputLabelProps:{shrink:!0}}),s.jsx(q,{label:"Fim",type:"datetime-local",value:x,onChange:p=>b(p.target.value),InputLabelProps:{shrink:!0}}),s.jsx(q,{label:"Mensagem contém",value:C,onChange:p=>j(p.target.value)}),s.jsxs(O,{children:[s.jsx(z,{variant:"subtitle2",children:"Níveis"}),s.jsx(st,{children:W.map(p=>s.jsx(Ae,{control:s.jsx(Ie,{checked:m[p],onChange:ye,name:p}),label:p.toUpperCase()},p))})]}),s.jsx(Oe,{}),s.jsx(V,{onClick:xe,variant:"outlined",size:"small",children:"Limpar Filtros"})]})}),s.jsx(Z,{title:"Alterar usuário (Ctrl + ')",children:s.jsx(V,{variant:"outlined",startIcon:s.jsx(Ft,{}),onClick:()=>c(!0),children:"Alterar"})})]})]}),o&&s.jsx(Ve,{}),i&&s.jsx(ee,{severity:"warning",sx:{mt:2},children:i}),e.length>0?s.jsx(bt,{component:Q,children:s.jsxs(nt,{sx:{minWidth:650},"aria-label":"simple table",children:[s.jsx(St,{children:s.jsxs(ie,{children:[s.jsx(R,{children:"Timestamp"}),s.jsx(R,{children:"Level"}),s.jsx(R,{children:"Message"}),s.jsx(R,{children:"URL"})]})}),s.jsx(ut,{children:e.map(p=>s.jsxs(ie,{children:[s.jsx(R,{children:Ge(p.timestamp)?.toLocaleString()}),s.jsx(R,{children:p.level}),s.jsx(R,{children:p.message}),s.jsx(R,{children:p.url})]},p.id))})]})}):!o&&n&&s.jsx(ee,{severity:"info",children:"Nenhum log encontrado para este usuário com os filtros aplicados."})]})};export{Pt as default};
