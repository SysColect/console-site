import{j as o,d as y,A as D,h as A,Y as F,r as a,g as P,B as b,a as R,C as N,W as I,b as O,D as B,L as V}from"./index-BTPhf6Rc.js";import{T as q}from"./ToolPageLayout-D6VjKgRe.js";import{F as L,R as E,N as v}from"./firestore.source-YeBl6uHF.js";const G=()=>a.useContext(P)?.values?.action!=="redirect"?null:o.jsx(y,{name:"actionProperties.redirectTo",label:"Caminho do Redirecionamento",placeholder:"some-path",formField:!0}),M=()=>{const n=a.useContext(P),{values:t,setFieldValue:s}=n||{},[h,c]=a.useState(!1),[T,x]=a.useState([]),[d,m]=a.useState([]),[u,C]=a.useState(!1),S=a.useMemo(()=>{const e=new L("consoleTool");return new E(e,new v)},[]);a.useEffect(()=>{C(!0),S.getAll().then(e=>{const i=e.filter(p=>p.action!=="group"&&p.id!==t?.id);m(i),C(!1)})},[S,t?.id]);const w=()=>{x(d),c(!0)},r=e=>{const i=t?.actionProperties?.tools||[];i.includes(e.id)||s?.("actionProperties.tools",[...i,e.id]),c(!1)},l=e=>{const i=t?.actionProperties?.tools||[];s?.("actionProperties.tools",i.filter(p=>p!==e))},g=e=>{if(!e){x(d);return}const i=e.toLowerCase();x(d.filter(p=>p.name.toLowerCase().includes(i)||p.description.toLowerCase().includes(i)))};if(t?.action!=="group")return null;const f=(t?.actionProperties?.tools||[]).map(e=>d.find(i=>i.id===e)||{id:e,name:e}).filter(e=>e.name);return o.jsxs(b,{sx:{my:2,p:2,border:"1px dashed grey",borderRadius:1},children:[o.jsx(R,{variant:"outlined",onClick:w,disabled:u,children:u?"Carregando...":"Adicionar Ferramenta ao Grupo"}),o.jsx(b,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:2},children:f.map(e=>o.jsx(N,{label:e.name,onDelete:()=>l(e.id)},e.id))}),o.jsx(I,{open:h,loading:u,onClose:()=>c(!1),onSelect:r,headerText:"Selecionar Ferramenta",searchLabel:"Buscar por nome ou descrição",items:T,itemKey:"id",displayFields:{primary:"name",secondary:"description"},onSearchChange:g})]})},W=()=>o.jsxs(o.Fragment,{children:[o.jsx(y,{name:"name",label:"Nome",formField:!0}),o.jsx(y,{name:"description",label:"Descrição",multiline:!0,rows:3,formField:!0}),o.jsx(D,{name:"icon",label:"Ícone",formField:!0}),o.jsx(A,{name:"action",label:"Ação",options:[{value:"redirect",label:"Redirecionar"},{value:"group",label:"Grupo"}],formField:!0}),o.jsx(G,{}),o.jsx(M,{})]}),k=n=>{const t={};if(t.name=F.required("O nome da ferramenta é obrigatório")(n.name),t.icon=F.required("Você deve selecionar um ícone")(n.icon),n.action==="redirect"){const s=n.actionProperties?.redirectTo;t["actionProperties.redirectTo"]=F.required("O caminho para o redirecionamento é obrigatório")(s)}if(n.action==="group"){const s=n.actionProperties?.tools;(!s||s.length===0)&&(t.actionProperties="Um grupo deve conter pelo menos uma ferramenta.")}return Object.entries(t).reduce((s,[h,c])=>(c&&(s[h]=c),s),{})},z=()=>{const[n,t]=a.useState([]),[s,h]=a.useState(!0),[c,T]=a.useState(null),{showConfirmation:x,showAlert:d}=O(),m=a.useMemo(()=>{const r=new L("consoleTool"),l=new v;return new E(r,l)},[]),u=a.useCallback(async()=>{h(!0),T(null);try{const r=await m.getAll({sort:{field:"name",direction:"asc"}});t(r)}catch(r){console.error("Error fetching data:",r),T("Falha ao carregar os dados. Por favor, tente novamente mais tarde.")}finally{h(!1)}},[m]);a.useEffect(()=>{u()},[u]);const C=[{field:"icon",headerName:"Ícone",width:80,renderCell:r=>o.jsx(V,{children:o.jsx("i",{className:`fa-solid fa-${r.value}`,style:{fontSize:20}})})},{field:"name",headerName:"Nome",width:250},{field:"description",headerName:"Descrição",flex:1},{field:"action",headerName:"Ação",width:150}],S=async(r,l)=>{const{id:g,...j}=r;try{if(l){const f=await m.create(j);t(e=>[...e,f])}else await m.update(g,j),t(f=>f.map(e=>e.id===g?{...e,...j,id:g}:e))}catch(f){console.error("Error saving tool:",f),d({title:"Erro",message:"Falha ao salvar a ferramenta."})}},w=r=>{x({title:"Confirmar Exclusão",message:`Você tem certeza que deseja excluir a ferramenta ${r.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{await m.delete(r.id),t(n.filter(l=>l.id!==r.id))}catch(l){console.error("Error deleting tool:",l),d({title:"Erro",message:"Falha ao excluir a ferramenta."})}}})};return o.jsx(B,{title:"Ferramentas",rows:n,columns:C,loading:s,error:c,initialValues:{name:"",description:"",icon:"",action:"redirect",actionProperties:{redirectTo:""}},dialogTitle:"Ferramenta",onSave:S,onDelete:w,onRefresh:u,onValidate:k,hideAddButton:!1,children:W()})},U=()=>o.jsx(q,{title:"Gerenciador de Ferramentas",children:o.jsx(z,{})});export{U as default};
