import{r as s,g as L,j as e,D as z,a as H,b as U,A as q,T as D,B as N,I as W,F as V,c as X,S as J,M,d as K,e as O,f as k,h as Q,i as $,s as Y,u as Z,k as _,C as ee,P as oe,L as te,l as se,m as ne}from"./index-BowguTbL.js";import{M as re}from"./MoreVert-B2qTNqdA.js";import{I as ae,S as le}from"./Search-Cayw2jNv.js";import{A as ie,I as ce}from"./IconPickerDialog-BawGLMRa.js";import{D as de}from"./DynamicSelectorDialog-DpoPdyz_.js";import{T as ue}from"./ToolPageLayout-CYGWEmfP.js";import{T as he,a as me,b as xe,c as B,d,e as pe}from"./TableRow-DeDaSUMP.js";const fe=({open:u,onClose:l,tool:n})=>{const[m,x]=s.useState(""),[T,p]=s.useState(""),[f,a]=s.useState("redirect"),[C,S]=s.useState(""),[j,i]=s.useState(""),[w,E]=s.useState(!1),[G,v]=s.useState(void 0),[y,g]=s.useState(""),[P,I]=s.useState(!1),[F,b]=s.useState(null),o=L();s.useEffect(()=>{const t=async h=>{const A=k(o,"consoleToolGroups",h),R=await Q(A);R.exists()&&g(R.data().name)};n?(x(n.name||""),p(n.description||""),a(n.action||"redirect"),S(n.actionProperties?.redirectTo||""),i(n.icon||""),v(n.toolGroup),n.toolGroup?t(n.toolGroup):g("")):(x(""),p(""),a("redirect"),S(""),i(""),v(void 0),g(""))},[n,o]);const r=async()=>{if(b(null),!m){b("Name is required.");return}const t={name:m,description:T,action:f,actionProperties:{redirectTo:C},icon:j,toolGroup:G};try{const h={...n,...t},A=n?k(o,"consoleTool",n.id):k($(o,"consoleTool"));await Y(A,t,{merge:!0}),l({...h,id:A.id})}catch(h){console.error("Error saving tool:",h),b("Failed to save tool.")}},c=t=>{t&&i(t),E(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{open:u,onClose:()=>l(),fullWidth:!0,maxWidth:"sm",children:[e.jsx(H,{children:n?"Edit Tool":"Add Tool"}),e.jsxs(U,{children:[F&&e.jsx(q,{severity:"error",sx:{mb:2},children:F}),e.jsx(D,{autoFocus:!0,margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,variant:"standard",value:m,onChange:t=>x(t.target.value)}),e.jsx(D,{margin:"dense",id:"description",label:"Description",type:"text",fullWidth:!0,multiline:!0,rows:3,variant:"standard",value:T,onChange:t=>p(t.target.value)}),e.jsxs(N,{sx:{display:"flex",alignItems:"flex-end"},children:[e.jsx(D,{margin:"dense",id:"icon",label:"Icon",type:"text",fullWidth:!0,variant:"standard",value:j,onChange:t=>i(t.target.value),helperText:"Use the name of a Font Awesome icon (e.g., 'home', 'gear')."}),e.jsx(W,{onClick:()=>E(!0),children:e.jsx(ie,{})})]}),e.jsx(D,{margin:"dense",id:"toolGroup",label:"Tool Group",type:"text",fullWidth:!0,disabled:!0,value:y,InputProps:{endAdornment:e.jsx(ae,{position:"end",children:e.jsx(W,{onClick:()=>I(!0),children:e.jsx(le,{})})})}}),e.jsxs(V,{fullWidth:!0,margin:"dense",children:[e.jsx(X,{id:"action-label",children:"Action"}),e.jsx(J,{labelId:"action-label",id:"action",value:f,label:"Action",onChange:t=>a(t.target.value),children:e.jsx(M,{value:"redirect",children:"redirect"})})]}),f==="redirect"&&e.jsx(D,{margin:"dense",id:"redirectTo",label:"Redirect Path",type:"text",fullWidth:!0,variant:"standard",value:C,onChange:t=>S(t.target.value),helperText:"E.g., /tools/my-custom-tool"})]}),e.jsxs(K,{children:[e.jsx(O,{onClick:()=>l(),children:"Cancel"}),e.jsx(O,{onClick:r,children:"Save"})]})]}),e.jsx(ce,{open:w,onClose:c}),e.jsx(de,{open:P,onClose:()=>I(!1),onSelect:(t,h)=>{v(t),g(h.name),I(!1)},collectionName:"consoleToolGroups",headerText:"Select Tool Group",searchField:"name",displayFields:{primary:"name",secondary:"description"}})]})},Ie=()=>{const[u,l]=s.useState([]),[n,m]=s.useState(!0),[x,T]=s.useState(null),[p,f]=s.useState(null),[a,C]=s.useState(null),[S,j]=s.useState(!1),i=L(),{showConfirmation:w,showAlert:E}=Z(),G=s.useCallback(async()=>{m(!0),T(null);try{const o=$(i,"consoleTool"),c=(await _(o)).docs.map(t=>({id:t.id,...t.data()}));l(c)}catch(o){console.error("Error fetching tools:",o),T("Failed to load tools. Please try again later.")}finally{m(!1)}},[i]);s.useEffect(()=>{G()},[G]);const v=(o,r)=>{f(o.currentTarget),C(r)},y=()=>{f(null)},g=()=>{C(null),j(!0)},P=()=>{j(!0),y()},I=()=>{y(),a&&w({title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir a ferramenta ${a.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{if(!a)return;const o=k(i,"consoleTool",a.id);await ne(o),l(u.filter(r=>r.id!==a.id))}catch(o){console.error("Error deleting tool:",o),E({title:"Erro",message:"Falha ao excluir a ferramenta. Tente novamente mais tarde."})}}})},F=o=>{if(j(!1),o){const r=u.findIndex(c=>c.id===o.id);if(r!==-1){const c=[...u];c[r]=o,l(c)}else l([o,...u])}},b=o=>o?e.jsx("i",{className:`fa-solid fa-${o}`}):null;return e.jsx(ue,{title:"Gerenciador de Ferramentas",actions:e.jsx(O,{variant:"contained",color:"secondary",onClick:g,children:"Incluir Ferramenta"}),children:n?e.jsx(N,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(ee,{})}):x?e.jsx(q,{severity:"error",children:x}):e.jsxs(N,{sx:{width:"100%",overflowX:"auto"},children:[e.jsx(he,{component:oe,children:e.jsxs(me,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(xe,{children:e.jsxs(B,{children:[e.jsx(d,{children:"Icon"}),e.jsx(d,{children:"Nome"}),e.jsx(d,{children:"Descrição"}),e.jsx(d,{children:"Ações"})]})}),e.jsx(pe,{children:u.map(o=>e.jsxs(B,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(d,{children:e.jsx(te,{children:b(o.icon)})}),e.jsx(d,{component:"th",scope:"row",children:o.name}),e.jsx(d,{children:o.description||"N/A"}),e.jsx(d,{children:e.jsx(W,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:r=>v(r,o),children:e.jsx(re,{})})})]},o.id))})]})}),e.jsxs(se,{id:"long-menu",anchorEl:p,open:!!p,onClose:y,children:[e.jsx(M,{onClick:P,children:"Editar"}),e.jsx(M,{onClick:I,children:"Excluir"})]}),e.jsx(fe,{open:S,onClose:F,tool:a})]})})};export{Ie as default};
