import{j as t,ar as f,as as E,at as b,r,Q as N,au as S,ao as p,z as x}from"./index-44ng3IKi.js";import{T as C}from"./ToolPageLayout-EmMhmdvk.js";import{F as L,R,N as T}from"./firestore.source-BvdjQgrB.js";const A=n=>t.jsxs(t.Fragment,{children:[t.jsx(f,{name:"name",label:"Nome",formField:!0}),t.jsx(f,{name:"abbreviation",label:"Abreviação",formField:!0}),t.jsx(E,{name:"holding",label:"Holding",optionsMap:n,formField:!0}),t.jsx(f,{name:"inactivationDate",label:"Data de Inativação",type:"date",formField:!0}),t.jsx(f,{name:"inclusionDate",label:"Data de Inclusão",type:"date",formField:!0,disabled:!0})]}),M=n=>{const o={};return o.name=b.required("O nome da organização é obrigatório")(n.name),o.abbreviation=b.required("A abreviação é obrigatória")(n.abbreviation),Object.entries(o).reduce((l,[h,g])=>(g&&(l[h]=g),l),{})},I=()=>{const[n,o]=r.useState([]),[l,h]=r.useState({}),[g,v]=r.useState(!0),[w,D]=r.useState(null),{showConfirmation:j,showAlert:z}=N(),d=r.useMemo(()=>{const e=new L("organization"),i=new T;return new R(e,i)},[]),c=r.useCallback(async()=>{v(!0),D(null);try{const e=await d.getAll({sort:{field:"name",direction:"asc"}});o(e);const i=e.reduce((a,s)=>(a[s.id]=s.name,a),{});h(i)}catch(e){console.error("Error fetching organizations:",e),D("Falha ao carregar as organizações. Por favor, tente novamente mais tarde.")}finally{v(!1)}},[d]);r.useEffect(()=>{c()},[c]);const O=[{field:"name",headerName:"Nome",width:250},{field:"abbreviation",headerName:"Abreviação",width:120},{field:"holding",headerName:"Holding",width:250,valueGetter:e=>l[e]||"-"},{field:"inclusionDate",headerName:"Data de Inclusão",width:180,valueGetter:e=>p(e)?.toLocaleDateString("pt-BR")||"-"},{field:"inactivationDate",headerName:"Data de Inativação",width:180,valueGetter:e=>e?p(e)?.toLocaleDateString("pt-BR"):"-"},{field:"id",headerName:"ID",flex:1}],y=async(e,i)=>{const a={...e},s=a.id;delete a.id,(a.holding===""||a.holding===void 0)&&(a.holding=null),a.inactivationDate=a.inactivationDate?x.fromDate(new Date(a.inactivationDate)):null;try{if(i){a.inclusionDate=x.now();const u=await d.create(a);o(m=>[...m,u])}else delete a.inclusionDate,await d.update(s,a),o(u=>u.map(m=>m.id===s?{...m,...a,id:s}:m));c()}catch(u){console.error("Error saving organization:",u),z({title:"Erro",message:"Falha ao salvar a organização."})}},F=e=>{j({title:"Confirmar Exclusão",message:`Você tem certeza que deseja excluir a organização ${e.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{await d.delete(e.id),o(n.filter(i=>i.id!==e.id)),c()}catch(i){console.error("Error deleting organization:",i),z({title:"Erro",message:"Falha ao excluir a organização. Por favor, tente novamente mais tarde."})}}})};return t.jsx(S,{title:"Organizações",rows:n,columns:O,loading:g,error:w,initialValues:{name:"",abbreviation:"",holding:null,inactivationDate:null,inclusionDate:null},dialogTitle:"Organização",onSave:y,onDelete:F,onRefresh:c,onValidate:M,hideAddButton:!1,children:A(l)})},B=()=>t.jsx(C,{title:"Gerenciador de Organizações",children:t.jsx(I,{})});export{B as default};
