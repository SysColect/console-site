import{j as o,O as b,c as D,N as I,e as j,r,I as P,a as E,D as L,C as N,B as w,b as R,d as v,X as O,F as A,L as V,f as B}from"./index-BDy3NKKd.js";import{T as q}from"./ToolPageLayout-B78edoqV.js";const G=()=>r.useContext(P)?.values?.action!=="redirect"?null:o.jsx(b,{name:"actionProperties.redirectTo",label:"Caminho do Redirecionamento",placeholder:"some-path",formField:!0}),M=()=>{const s=r.useContext(P),{values:t,setFieldValue:n}=s||{},[h,l]=r.useState(!1),[C,x]=r.useState([]),[c,d]=r.useState([]),[m,T]=r.useState(!1),y=r.useMemo(()=>E.getRepository("consoleTool",L.Firestore,N.NoCache),[]);r.useEffect(()=>{T(!0),y.getAll().then(e=>{const i=e.filter(p=>p.action!=="group"&&p.id!==t?.id);d(i),T(!1)})},[y,t?.id]);const S=()=>{x(c),l(!0)},a=e=>{const i=t?.actionProperties?.tools||[];i.includes(e.id)||n?.("actionProperties.tools",[...i,e.id]),l(!1)},u=e=>{const i=t?.actionProperties?.tools||[];n?.("actionProperties.tools",i.filter(p=>p!==e))},g=e=>{if(!e){x(c);return}const i=e.toLowerCase();x(c.filter(p=>p.name.toLowerCase().includes(i)||p.description.toLowerCase().includes(i)))};if(t?.action!=="group")return null;const f=(t?.actionProperties?.tools||[]).map(e=>c.find(i=>i.id===e)||{id:e,name:e}).filter(e=>e.name);return o.jsxs(w,{sx:{my:2,p:2,border:"1px dashed grey",borderRadius:1},children:[o.jsx(R,{variant:"outlined",onClick:S,disabled:m,children:m?"Carregando...":"Adicionar Ferramenta ao Grupo"}),o.jsx(w,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:2},children:f.map(e=>o.jsx(v,{label:e.name,onDelete:()=>u(e.id)},e.id))}),o.jsx(O,{open:h,loading:m,onClose:()=>l(!1),onSelect:a,headerText:"Selecionar Ferramenta",searchLabel:"Buscar por nome ou descrição",items:C,itemKey:"id",displayFields:{primary:"name",secondary:"description"},onSearchChange:g})]})},k=()=>o.jsxs(o.Fragment,{children:[o.jsx(b,{name:"name",label:"Nome",formField:!0}),o.jsx(b,{name:"description",label:"Descrição",multiline:!0,rows:3,formField:!0}),o.jsx(D,{name:"icon",label:"Ícone",formField:!0}),o.jsx(I,{name:"action",label:"Ação",options:[{value:"redirect",label:"Redirecionar"},{value:"group",label:"Grupo"}],formField:!0}),o.jsx(G,{}),o.jsx(M,{})]}),z=s=>{const t={};if(t.name=j.required("O nome da ferramenta é obrigatório")(s.name),t.icon=j.required("Você deve selecionar um ícone")(s.icon),s.action==="redirect"){const n=s.actionProperties?.redirectTo;t["actionProperties.redirectTo"]=j.required("O caminho para o redirecionamento é obrigatório")(n)}if(s.action==="group"){const n=s.actionProperties?.tools;(!n||n.length===0)&&(t.actionProperties="Um grupo deve conter pelo menos uma ferramenta.")}return Object.entries(t).reduce((n,[h,l])=>(l&&(n[h]=l),n),{})},X=()=>{const[s,t]=r.useState([]),[n,h]=r.useState(!0),[l,C]=r.useState(null),{showConfirmation:x,showAlert:c}=A(),d=r.useMemo(()=>E.getRepository("consoleTool",L.Firestore,N.NoCache),[]),m=r.useCallback(async()=>{h(!0),C(null);try{const a=await d.getAll({sort:{field:"name",direction:"asc"}});t(a)}catch(a){console.error("Error fetching data:",a),C("Falha ao carregar os dados. Por favor, tente novamente mais tarde.")}finally{h(!1)}},[d]);r.useEffect(()=>{m()},[m]);const T=[{field:"icon",headerName:"Ícone",width:80,renderCell:a=>o.jsx(B,{children:o.jsx("i",{className:`fa-solid fa-${a.value}`,style:{fontSize:20}})})},{field:"name",headerName:"Nome",width:250},{field:"description",headerName:"Descrição",flex:1},{field:"action",headerName:"Ação",width:150}],y=async(a,u)=>{const{id:g,...F}=a;try{if(u){const f=await d.create(F);t(e=>[...e,f])}else await d.update(g,F),t(f=>f.map(e=>e.id===g?{...e,...F,id:g}:e))}catch(f){console.error("Error saving tool:",f),c({title:"Erro",message:"Falha ao salvar a ferramenta."})}},S=a=>{x({title:"Confirmar Exclusão",message:`Você tem certeza que deseja excluir a ferramenta ${a.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{await d.delete(a.id),t(s.filter(u=>u.id!==a.id))}catch(u){console.error("Error deleting tool:",u),c({title:"Erro",message:"Falha ao excluir a ferramenta."})}}})};return o.jsx(V,{title:"Ferramentas",rows:s,columns:T,loading:n,error:l,initialValues:{name:"",description:"",icon:"",action:"redirect",actionProperties:{redirectTo:""}},dialogTitle:"Ferramenta",onSave:y,onDelete:S,onRefresh:m,onValidate:z,hideAddButton:!1,children:k()})},U=()=>o.jsx(q,{title:"Gerenciador de Ferramentas",children:o.jsx(X,{})});export{U as default};
