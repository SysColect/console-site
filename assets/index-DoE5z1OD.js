import{ag as ke,r as l,ah as Re,j as o,a2 as M,ai as Me,aj as Y,ak as I,al as Fe,am as Le,an as De,a3 as F,Z as L,ao as Ue,ap as J,$ as N,a0 as D,aq as Ne,ar as $e,a1 as U,a5 as W,a7 as H,c as He,as as z,at as ce,au as de,av as ue,aw as pe,ax as ze,ay as me,u as Be,ad as X,az as Pe,B as O,T as P,I as Z,e as V,aA as Ae,H as G,aB as Ee,aC as Ie,ae as Oe,p as Ve,A as Q,h as ee}from"./index-DLja3hGy.js";import{M as Ge}from"./ManageAccounts-CMaSYY88.js";import{T as qe}from"./ToolPageLayout-BXICLrQ5.js";import{f as We}from"./dateUtils-Lijm-n4x.js";const Ke=Ue(),_e=ke("div",{name:"MuiStack",slot:"Root"});function Ye(e){return Me({props:e,name:"MuiStack",defaultTheme:Ke})}function Je(e,t){const s=l.Children.toArray(e).filter(Boolean);return s.reduce((a,i,r)=>(a.push(i),r<s.length-1&&a.push(l.cloneElement(t,{key:`separator-${r}`})),a),[])}const Xe=e=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[e],Ze=({ownerState:e,theme:t})=>{let s={display:"flex",flexDirection:"column",...Y({theme:t},I({values:e.direction,breakpoints:t.breakpoints.values}),a=>({flexDirection:a}))};if(e.spacing){const a=Fe(t),i=Object.keys(t.breakpoints.values).reduce((n,d)=>((typeof e.spacing=="object"&&e.spacing[d]!=null||typeof e.direction=="object"&&e.direction[d]!=null)&&(n[d]=!0),n),{}),r=I({values:e.direction,base:i}),u=I({values:e.spacing,base:i});typeof r=="object"&&Object.keys(r).forEach((n,d,m)=>{if(!r[n]){const g=d>0?r[m[d-1]]:"column";r[n]=g}}),s=Le(s,Y({theme:t},u,(n,d)=>e.useFlexGap?{gap:J(a,n)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${Xe(d?r[d]:e.direction)}`]:J(a,n)}}))}return s=De(t.breakpoints,s),s};function Qe(e={}){const{createStyledComponent:t=_e,useThemeProps:s=Ye,componentName:a="MuiStack"}=e,i=()=>F({root:["root"]},n=>L(a,n),{}),r=t(Ze);return l.forwardRef(function(n,d){const m=s(n),y=Re(m),{component:g="div",direction:h="column",spacing:x=0,divider:b,children:f,className:v,useFlexGap:C=!1,...j}=y,w={direction:h,spacing:x,useFlexGap:C},S=i();return o.jsx(r,{as:g,ownerState:w,ref:d,className:M(S.root,v),...j,children:b?Je(f,b):f})})}function et(e){return L("MuiFormGroup",e)}N("MuiFormGroup",["root","row","error"]);const tt=e=>{const{classes:t,row:s,error:a}=e;return F({root:["root",s&&"row",a&&"error"]},et,t)},st=U("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),ot=l.forwardRef(function(t,s){const a=D({props:t,name:"MuiFormGroup"}),{className:i,row:r=!1,...u}=a,c=Ne(),n=$e({props:a,muiFormControl:c,states:["error"]}),d={...a,row:r,error:n.error},m=tt(d);return o.jsx(st,{className:M(m.root,i),ownerState:d,ref:s,...u})}),te=Qe({createStyledComponent:U("div",{name:"MuiStack",slot:"Root"}),useThemeProps:e=>D({props:e,name:"MuiStack"})}),fe=l.createContext();function at(e){return L("MuiTable",e)}N("MuiTable",["root","stickyHeader"]);const rt=e=>{const{classes:t,stickyHeader:s}=e;return F({root:["root",s&&"stickyHeader"]},at,t)},nt=U("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.stickyHeader&&t.stickyHeader]}})(W(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),se="table",lt=l.forwardRef(function(t,s){const a=D({props:t,name:"MuiTable"}),{className:i,component:r=se,padding:u="normal",size:c="medium",stickyHeader:n=!1,...d}=a,m={...a,component:r,padding:u,size:c,stickyHeader:n},y=rt(m),g=l.useMemo(()=>({padding:u,size:c,stickyHeader:n}),[u,c,n]);return o.jsx(fe.Provider,{value:g,children:o.jsx(nt,{as:r,role:r===se?null:"table",ref:s,className:M(y.root,i),ownerState:m,...d})})}),A=l.createContext();function it(e){return L("MuiTableBody",e)}N("MuiTableBody",["root"]);const ct=e=>{const{classes:t}=e;return F({root:["root"]},it,t)},dt=U("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),ut={variant:"body"},oe="tbody",pt=l.forwardRef(function(t,s){const a=D({props:t,name:"MuiTableBody"}),{className:i,component:r=oe,...u}=a,c={...a,component:r},n=ct(c);return o.jsx(A.Provider,{value:ut,children:o.jsx(dt,{className:M(n.root,i),as:r,ref:s,role:r===oe?null:"rowgroup",ownerState:c,...u})})});function mt(e){return L("MuiTableCell",e)}const ft=N("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),gt=e=>{const{classes:t,variant:s,align:a,padding:i,size:r,stickyHeader:u}=e,c={root:["root",s,u&&"stickyHeader",a!=="inherit"&&`align${H(a)}`,i!=="normal"&&`padding${H(i)}`,`size${H(r)}`]};return F(c,mt,t)},ht=U("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[s.variant],t[`size${H(s.size)}`],s.padding!=="normal"&&t[`padding${H(s.padding)}`],s.align!=="inherit"&&t[`align${H(s.align)}`],s.stickyHeader&&t.stickyHeader]}})(W(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${ft.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),R=l.forwardRef(function(t,s){const a=D({props:t,name:"MuiTableCell"}),{align:i="inherit",className:r,component:u,padding:c,scope:n,size:d,sortDirection:m,variant:y,...g}=a,h=l.useContext(fe),x=l.useContext(A),b=x&&x.variant==="head";let f;u?f=u:f=b?"th":"td";let v=n;f==="td"?v=void 0:!v&&b&&(v="col");const C=y||x&&x.variant,j={...a,align:i,component:f,padding:c||(h&&h.padding?h.padding:"normal"),size:d||(h&&h.size?h.size:"medium"),sortDirection:m,stickyHeader:C==="head"&&h&&h.stickyHeader,variant:C},w=gt(j);let S=null;return m&&(S=m==="asc"?"ascending":"descending"),o.jsx(ht,{as:f,ref:s,className:M(w.root,r),"aria-sort":S,scope:v,ownerState:j,...g})});function yt(e){return L("MuiTableContainer",e)}N("MuiTableContainer",["root"]);const xt=e=>{const{classes:t}=e;return F({root:["root"]},yt,t)},bt=U("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),vt=l.forwardRef(function(t,s){const a=D({props:t,name:"MuiTableContainer"}),{className:i,component:r="div",...u}=a,c={...a,component:r},n=xt(c);return o.jsx(bt,{ref:s,as:r,className:M(n.root,i),ownerState:c,...u})});function Ct(e){return L("MuiTableHead",e)}N("MuiTableHead",["root"]);const Tt=e=>{const{classes:t}=e;return F({root:["root"]},Ct,t)},jt=U("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),St={variant:"head"},ae="thead",wt=l.forwardRef(function(t,s){const a=D({props:t,name:"MuiTableHead"}),{className:i,component:r=ae,...u}=a,c={...a,component:r},n=Tt(c);return o.jsx(A.Provider,{value:St,children:o.jsx(jt,{as:r,className:M(n.root,i),ref:s,role:r===ae?null:"rowgroup",ownerState:c,...u})})});function kt(e){return L("MuiTableRow",e)}const re=N("MuiTableRow",["root","selected","hover","head","footer"]),Rt=e=>{const{classes:t,selected:s,hover:a,head:i,footer:r}=e;return F({root:["root",s&&"selected",a&&"hover",i&&"head",r&&"footer"]},kt,t)},Mt=U("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,s.head&&t.head,s.footer&&t.footer]}})(W(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${re.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${re.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)}}}))),ne="tr",le=l.forwardRef(function(t,s){const a=D({props:t,name:"MuiTableRow"}),{className:i,component:r=ne,hover:u=!1,selected:c=!1,...n}=a,d=l.useContext(A),m={...a,component:r,hover:u,selected:c,head:d&&d.variant==="head",footer:d&&d.variant==="footer"},y=Rt(m);return o.jsx(Mt,{as:r,ref:s,className:M(y.root,i),role:r===ne?null:"row",ownerState:m,...n})}),Ft=He(o.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}));function ge(e,t){const[s,a]=l.useState(e);return l.useEffect(()=>{const i=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(i)}},[e,t]),s}const Lt=[],Dt=({open:e,onClose:t,onUserSelect:s,additionalQueryConstraints:a=Lt,dialogHeaderText:i="Selecionar Usuário",searchLabel:r="Buscar por email"})=>{const[u,c]=l.useState([]),[n,d]=l.useState(!1),[m,y]=l.useState(""),g=ge(m,500),h=l.useCallback(async b=>{d(!0);try{const f="email",v="user",C=[...a];b&&(C.push(z(f,">=",b)),C.push(z(f,"<=",b+"")));const j=ce(de(ue,v),...C,pe(f),ze(50)),S=(await me(j)).docs.map(B=>({id:B.id,...B.data()}));c(S)}catch(f){console.error("Error fetching users: ",f)}finally{d(!1)}},[a]);l.useEffect(()=>{e&&h(g)},[g,h,e]);const x=b=>{s(b),t()};return o.jsx(Be,{open:e,loading:n,onClose:t,onSelect:x,headerText:i,searchLabel:r,items:u,itemKey:"id",displayFields:{primary:"name",secondary:"email"},onSearchChange:y})},Ut=(e="")=>e.split(" ").map(a=>a[0]).join("").toUpperCase(),q=["INFO","WARN","ERROR","DEBUG"],ie=q.reduce((e,t)=>({...e,[t]:!0}),{}),Pt=()=>{const[e,t]=l.useState([]),[s,a]=l.useState(!1),[i,r]=l.useState(null),[u,c]=l.useState(!0),[n,d]=l.useState(null),[m,y]=l.useState(null),[g,h]=l.useState(""),[x,b]=l.useState(""),[f,v]=l.useState(ie),[C,j]=l.useState(""),w=ge(C,500),S=l.useRef(null);l.useEffect(()=>{const p=T=>{T.ctrlKey&&T.key==="'"&&(T.preventDefault(),c(!0)),T.ctrlKey&&T.shiftKey&&T.key.toLowerCase()==="f"&&(T.preventDefault(),y(S.current))};return document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p)}},[]),l.useEffect(()=>{(async()=>{if(n){a(!0),r(null);try{const T=de(ue,"consoleLogs"),E=[z("userId","==",n.id)];g&&!isNaN(new Date(g).getTime())&&E.push(z("timestamp",">=",ee.fromDate(new Date(g)))),x&&!isNaN(new Date(x).getTime())&&E.push(z("timestamp","<=",ee.fromDate(new Date(x))));const Ce=ce(T,...E,pe("timestamp","desc")),Te=(await me(Ce)).docs.flatMap(k=>{const $=k.data();return $.events&&Array.isArray($.events)?$.events.map((_,we)=>({..._,id:`${k.id}-${we}`,url:$.url,userId:$.userId,timestamp:_.timestamp})):{...$,id:k.id}}),K=Object.keys(f).filter(k=>f[k]),je=K.length===q.length,Se=Te.filter(k=>!(!je&&!K.includes(k.level)||w&&!k.message.toLowerCase().includes(w.toLowerCase())));t(Se)}catch(T){console.error("Error fetching logs:",T),r("Failed to fetch logs.")}finally{a(!1)}}})()},[n,g,x,f,w]);const B=p=>{d(p),c(!1)},he=p=>{v({...f,[p.target.name]:p.target.checked})},ye=()=>{h(""),b(""),v(ie),j("")},xe=p=>y(p.currentTarget),be=()=>y(null),ve=!!m;return o.jsxs(qe,{title:"Visualizador de Logs",children:[u&&o.jsx(Dt,{open:u,onClose:()=>c(!1),onUserSelect:B}),n&&o.jsxs(X,{sx:{p:2,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[o.jsxs(te,{direction:"row",spacing:2,alignItems:"center",children:[o.jsx(Pe,{sx:{width:56,height:56},children:Ut(n.name)}),o.jsxs(O,{children:[o.jsx(P,{variant:"h5",component:"div",children:n.name}),o.jsx(P,{variant:"body2",color:"text.secondary",children:n.email})]})]}),o.jsxs(te,{direction:"row",spacing:1,alignItems:"center",sx:{mt:{xs:2,md:0}},children:[o.jsx(Z,{title:"Filtros (Ctrl + Shift + F)",children:o.jsx(V,{variant:"outlined",startIcon:o.jsx(Ft,{}),onClick:xe,ref:S,children:"Filtros"})}),o.jsx(Ae,{open:ve,anchorEl:m,onClose:be,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:o.jsxs(O,{sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:300},children:[o.jsx(P,{variant:"subtitle1",children:"Filtros"}),o.jsx(G,{label:"Início",type:"datetime-local",value:g,onChange:p=>h(p.target.value),InputLabelProps:{shrink:!0}}),o.jsx(G,{label:"Fim",type:"datetime-local",value:x,onChange:p=>b(p.target.value),InputLabelProps:{shrink:!0}}),o.jsx(G,{label:"Mensagem contém",value:C,onChange:p=>j(p.target.value)}),o.jsxs(O,{children:[o.jsx(P,{variant:"subtitle2",children:"Níveis"}),o.jsx(ot,{children:q.map(p=>o.jsx(Ee,{control:o.jsx(Ie,{checked:f[p],onChange:he,name:p}),label:p.toUpperCase()},p))})]}),o.jsx(Oe,{}),o.jsx(V,{onClick:ye,variant:"outlined",size:"small",children:"Limpar Filtros"})]})}),o.jsx(Z,{title:"Alterar usuário (Ctrl + ')",children:o.jsx(V,{variant:"outlined",startIcon:o.jsx(Ge,{}),onClick:()=>c(!0),children:"Alterar"})})]})]}),s&&o.jsx(Ve,{}),i&&o.jsx(Q,{severity:"warning",sx:{mt:2},children:i}),e.length>0?o.jsx(vt,{component:X,children:o.jsxs(lt,{sx:{minWidth:650},"aria-label":"simple table",children:[o.jsx(wt,{children:o.jsxs(le,{children:[o.jsx(R,{children:"Timestamp"}),o.jsx(R,{children:"Level"}),o.jsx(R,{children:"Message"}),o.jsx(R,{children:"URL"})]})}),o.jsx(pt,{children:e.map(p=>o.jsxs(le,{children:[o.jsx(R,{children:We(p.timestamp)?.toLocaleString()}),o.jsx(R,{children:p.level}),o.jsx(R,{children:p.message}),o.jsx(R,{children:p.url})]},p.id))})]})}):!s&&n&&o.jsx(Q,{severity:"info",children:"Nenhum log encontrado para este usuário com os filtros aplicados."})]})};export{Pt as default};
