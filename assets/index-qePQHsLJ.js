import{Z as ge,r as l,$ as ye,j as e,a0 as Y,a1 as je,a2 as G,a3 as I,a4 as Se,a5 as ve,a6 as Ce,a7 as J,a8 as Z,a9 as be,aa as O,ab as Fe,ac as Q,ad as Te,ae as Le,af as ee,g as se,ag as w,ah as te,J as re,ai as V,aj as oe,ak as ke,K as ae,X as De,R as z,al as we,B as U,T as R,am as K,b as P,an as Ee,v as N,ao as Re,P as Me,ap as Ie,p as Ue,A as $,E as W}from"./index-BZrIBs07.js";import{T as Pe}from"./ToolPageLayout-C5UHLxGO.js";import{f as Ne}from"./dateUtils-BUPt2Fsv.js";import{T as Ve,a as Ae,b as Be,c as _,d as C,e as qe}from"./TableRow-zg8OfqvF.js";const Ge=be(),Oe=ge("div",{name:"MuiStack",slot:"Root"});function ze(s){return je({props:s,name:"MuiStack",defaultTheme:Ge})}function Ke(s,t){const n=l.Children.toArray(s).filter(Boolean);return n.reduce((o,u,i)=>(o.push(u),i<n.length-1&&o.push(l.cloneElement(t,{key:`separator-${i}`})),o),[])}const $e=s=>({row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"})[s],We=({ownerState:s,theme:t})=>{let n={display:"flex",flexDirection:"column",...G({theme:t},I({values:s.direction,breakpoints:t.breakpoints.values}),o=>({flexDirection:o}))};if(s.spacing){const o=Se(t),u=Object.keys(t.breakpoints.values).reduce((a,c)=>((typeof s.spacing=="object"&&s.spacing[c]!=null||typeof s.direction=="object"&&s.direction[c]!=null)&&(a[c]=!0),a),{}),i=I({values:s.direction,base:u}),g=I({values:s.spacing,base:u});typeof i=="object"&&Object.keys(i).forEach((a,c,x)=>{if(!i[a]){const m=c>0?i[x[c-1]]:"column";i[a]=m}}),n=ve(n,G({theme:t},g,(a,c)=>s.useFlexGap?{gap:O(o,a)}:{"& > :not(style):not(style)":{margin:0},"& > :not(style) ~ :not(style)":{[`margin${$e(c?i[c]:s.direction)}`]:O(o,a)}}))}return n=Ce(t.breakpoints,n),n};function _e(s={}){const{createStyledComponent:t=Oe,useThemeProps:n=ze,componentName:o="MuiStack"}=s,u=()=>J({root:["root"]},a=>Z(o,a),{}),i=t(We);return l.forwardRef(function(a,c){const x=n(a),j=ye(x),{component:m="div",direction:b="column",spacing:y=0,divider:h,children:d,className:F,useFlexGap:S=!1,...T}=j,L={direction:b,spacing:y,useFlexGap:S},k=u();return e.jsx(i,{as:m,ownerState:L,ref:c,className:Y(k.root,F),...T,children:h?Ke(d,h):d})})}function He(s){return Z("MuiFormGroup",s)}Fe("MuiFormGroup",["root","row","error"]);const Xe=s=>{const{classes:t,row:n,error:o}=s;return J({root:["root",n&&"row",o&&"error"]},He,t)},Ye=ee("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(s,t)=>{const{ownerState:n}=s;return[t.root,n.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Je=l.forwardRef(function(t,n){const o=Q({props:t,name:"MuiFormGroup"}),{className:u,row:i=!1,...g}=o,p=Te(),a=Le({props:o,muiFormControl:p,states:["error"]}),c={...o,row:i,error:a.error},x=Xe(c);return e.jsx(Ye,{className:Y(x.root,u),ownerState:c,ref:n,...g})}),H=_e({createStyledComponent:ee("div",{name:"MuiStack",slot:"Root"}),useThemeProps:s=>Q({props:s,name:"MuiStack"})}),Ze=se([e.jsx("circle",{cx:"10",cy:"8",r:"4"},"0"),e.jsx("path",{d:"M10.67 13.02c-.22-.01-.44-.02-.67-.02-2.42 0-4.68.67-6.61 1.82-.88.52-1.39 1.5-1.39 2.53V20h9.26c-.79-1.13-1.26-2.51-1.26-4 0-1.07.25-2.07.67-2.98M20.75 16c0-.22-.03-.42-.06-.63l1.14-1.01-1-1.73-1.45.49q-.48-.405-1.08-.63L18 11h-2l-.3 1.49q-.6.225-1.08.63l-1.45-.49-1 1.73 1.14 1.01c-.03.21-.06.41-.06.63s.03.42.06.63l-1.14 1.01 1 1.73 1.45-.49q.48.405 1.08.63L16 21h2l.3-1.49q.6-.225 1.08-.63l1.45.49 1-1.73-1.14-1.01c.03-.21.06-.41.06-.63M17 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"},"1")]),Qe=se(e.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}));function ne(s,t){const[n,o]=l.useState(s);return l.useEffect(()=>{const u=setTimeout(()=>{o(s)},t);return()=>{clearTimeout(u)}},[s,t]),n}const es=[],ss=({open:s,onClose:t,onUserSelect:n,additionalQueryConstraints:o=es,dialogHeaderText:u="Selecionar Usuário",searchLabel:i="Buscar por email"})=>{const[g,p]=l.useState([]),[a,c]=l.useState(!1),[x,j]=l.useState(""),m=ne(x,500),b=l.useCallback(async h=>{c(!0);try{const d="email",F="user",S=[...o];h&&(S.push(w(d,">=",h)),S.push(w(d,"<=",h+"")));const T=te(re(V,F),...S,oe(d),ke(50)),k=(await ae(T)).docs.map(E=>({id:E.id,...E.data()}));p(k)}catch(d){console.error("Error fetching users: ",d)}finally{c(!1)}},[V,o]);l.useEffect(()=>{s&&b(m)},[m,b,s]);const y=h=>{n(h),t()};return e.jsx(De,{open:s,loading:a,onClose:t,onSelect:y,headerText:u,searchLabel:i,items:g,itemKey:"id",displayFields:{primary:"name",secondary:"email"},onSearchChange:j})},ts=(s="")=>s.split(" ").map(o=>o[0]).join("").toUpperCase(),A=["INFO","WARN","ERROR","DEBUG"],X=A.reduce((s,t)=>({...s,[t]:!0}),{}),cs=()=>{const[s,t]=l.useState([]),[n,o]=l.useState(!1),[u,i]=l.useState(null),[g,p]=l.useState(!0),[a,c]=l.useState(null),[x,j]=l.useState(null),[m,b]=l.useState(""),[y,h]=l.useState(""),[d,F]=l.useState(X),[S,T]=l.useState(""),L=ne(S,500),k=l.useRef(null);l.useEffect(()=>{const r=f=>{f.ctrlKey&&f.key==="'"&&(f.preventDefault(),p(!0)),f.ctrlKey&&f.shiftKey&&f.key.toLowerCase()==="f"&&(f.preventDefault(),j(k.current))};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[]),l.useEffect(()=>{(async()=>{if(a){o(!0),i(null);try{const f=re(V,"consoleLogs"),M=[w("userId","==",a.id)];m&&!isNaN(new Date(m).getTime())&&M.push(w("timestamp",">=",W.fromDate(new Date(m)))),y&&!isNaN(new Date(y).getTime())&&M.push(w("timestamp","<=",W.fromDate(new Date(y))));const me=te(f,...M,oe("timestamp","desc")),pe=(await ae(me)).docs.flatMap(v=>{const D=v.data();return D.events&&Array.isArray(D.events)?D.events.map((q,xe)=>({...q,id:`${v.id}-${xe}`,url:D.url,userId:D.userId,timestamp:q.timestamp})):{...D,id:v.id}}),B=Object.keys(d).filter(v=>d[v]),he=B.length===A.length,fe=pe.filter(v=>!(!he&&!B.includes(v.level)||L&&!v.message.toLowerCase().includes(L.toLowerCase())));t(fe)}catch(f){console.error("Error fetching logs:",f),i("Failed to fetch logs.")}finally{o(!1)}}})()},[a,m,y,d,L]);const E=r=>{c(r),p(!1)},le=r=>{F({...d,[r.target.name]:r.target.checked})},ce=()=>{b(""),h(""),F(X),T("")},ie=r=>j(r.currentTarget),ue=()=>j(null),de=!!x;return e.jsxs(Pe,{title:"Visualizador de Logs",children:[g&&e.jsx(ss,{open:g,onClose:()=>p(!1),onUserSelect:E}),a&&e.jsxs(z,{sx:{p:2,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[e.jsxs(H,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(we,{sx:{width:56,height:56},children:ts(a.name)}),e.jsxs(U,{children:[e.jsx(R,{variant:"h5",component:"div",children:a.name}),e.jsx(R,{variant:"body2",color:"text.secondary",children:a.email})]})]}),e.jsxs(H,{direction:"row",spacing:1,alignItems:"center",sx:{mt:{xs:2,md:0}},children:[e.jsx(K,{title:"Filtros (Ctrl + Shift + F)",children:e.jsx(P,{variant:"outlined",startIcon:e.jsx(Qe,{}),onClick:ie,ref:k,children:"Filtros"})}),e.jsx(Ee,{open:de,anchorEl:x,onClose:ue,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(U,{sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:300},children:[e.jsx(R,{variant:"subtitle1",children:"Filtros"}),e.jsx(N,{label:"Início",type:"datetime-local",value:m,onChange:r=>b(r.target.value),InputLabelProps:{shrink:!0}}),e.jsx(N,{label:"Fim",type:"datetime-local",value:y,onChange:r=>h(r.target.value),InputLabelProps:{shrink:!0}}),e.jsx(N,{label:"Mensagem contém",value:S,onChange:r=>T(r.target.value)}),e.jsxs(U,{children:[e.jsx(R,{variant:"subtitle2",children:"Níveis"}),e.jsx(Je,{children:A.map(r=>e.jsx(Re,{control:e.jsx(Me,{checked:d[r],onChange:le,name:r}),label:r.toUpperCase()},r))})]}),e.jsx(Ie,{}),e.jsx(P,{onClick:ce,variant:"outlined",size:"small",children:"Limpar Filtros"})]})}),e.jsx(K,{title:"Alterar usuário (Ctrl + ')",children:e.jsx(P,{variant:"outlined",startIcon:e.jsx(Ze,{}),onClick:()=>p(!0),children:"Alterar"})})]})]}),n&&e.jsx(Ue,{}),u&&e.jsx($,{severity:"warning",sx:{mt:2},children:u}),s.length>0?e.jsx(Ve,{component:z,children:e.jsxs(Ae,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Be,{children:e.jsxs(_,{children:[e.jsx(C,{children:"Timestamp"}),e.jsx(C,{children:"Level"}),e.jsx(C,{children:"Message"}),e.jsx(C,{children:"URL"})]})}),e.jsx(qe,{children:s.map(r=>e.jsxs(_,{children:[e.jsx(C,{children:Ne(r.timestamp)?.toLocaleString()}),e.jsx(C,{children:r.level}),e.jsx(C,{children:r.message}),e.jsx(C,{children:r.url})]},r.id))})]})}):!n&&a&&e.jsx($,{severity:"info",children:"Nenhum log encontrado para este usuário com os filtros aplicados."})]})};export{cs as default};
