import{r as i,g as P,Y as z,j as t,D as B,a as L,b as X,A as R,T as b,f as G,I as W,i as V,k as A,X as Y,l as k,m as F,s as $,H as I,n as q,a1 as J,o as K,p as Q,B as H,C as U,P as Z,q as _,M as N,t as ee}from"./index-DYHoXdso.js";import{M as te}from"./MoreVert-CgrGSDwl.js";import{S as ae}from"./Search-DRs91dH_.js";import{T as ne}from"./ToolPageLayout-B0UWFUD6.js";import{T as ie,a as se,b as oe,c as M,d as c,e as re}from"./TableRow-BXVGgdlF.js";const le=({open:d,onClose:o,organization:n})=>{const[u,x]=i.useState(""),[h,f]=i.useState(""),[S,r]=i.useState(null),[l,C]=i.useState(null),[D,m]=i.useState(void 0),[O,p]=i.useState(""),[E,y]=i.useState(!1),[j,v]=i.useState(null),g=P();i.useEffect(()=>{const e=async a=>{const s=k(g,"organization",a),T=await F(s);T.exists()&&p(T.data().name)};n?(x(n.name||""),f(n.abbreviation||""),r(z(n.inclusionDate)),C(z(n.inactivationDate)),m(n.holding),n.holding?e(n.holding):p("")):(x(""),f(""),r(null),C(null),m(void 0),p(""))},[n,g]);const w=async()=>{if(v(null),!u||!h){v("Please fill in all required fields.");return}try{if(n){const e=k(g,"organization",n.id),a=await F(e),s={name:u,abbreviation:h,inactivationDate:l,holding:D};(!a.exists()||!a.data()?.inclusionDate)&&(s.inclusionDate=new Date),await $(e,s,{merge:!0}),o({...n,...s,inclusionDate:s.inclusionDate?I.fromDate(s.inclusionDate):n.inclusionDate,inactivationDate:l?I.fromDate(l):void 0})}else{const e=q(g,"organization"),a={name:u,abbreviation:h,inclusionDate:new Date,inactivationDate:l,holding:D},s=await J(e,a);o({id:s.id,...a,inclusionDate:I.fromDate(a.inclusionDate),inactivationDate:a.inactivationDate?I.fromDate(a.inactivationDate):void 0})}}catch(e){e instanceof Error?v(e.message):v("An unexpected error occurred."),console.error("Error saving organization:",e)}};return t.jsxs(B,{open:d,onClose:()=>o(),children:[t.jsx(L,{children:n?"Edit Organization":"Add Organization"}),t.jsxs(X,{children:[j&&t.jsx(R,{severity:"error",sx:{mb:2},children:j}),n&&t.jsx(b,{autoFocus:!0,margin:"dense",id:"id",label:"Organization ID",type:"text",fullWidth:!0,disabled:!0,value:n?.id||""}),t.jsx(b,{margin:"dense",id:"name",label:"Name",type:"text",fullWidth:!0,value:u,onChange:e=>x(e.target.value)}),t.jsx(b,{margin:"dense",id:"abbreviation",label:"Abbreviation",type:"text",fullWidth:!0,value:h,onChange:e=>f(e.target.value)}),t.jsx(b,{margin:"dense",id:"holding",label:"Holding",type:"text",fullWidth:!0,disabled:!0,value:O,InputProps:{endAdornment:t.jsx(G,{position:"end",children:t.jsx(W,{onClick:()=>y(!0),children:t.jsx(ae,{})})})}}),t.jsx(b,{margin:"dense",id:"inclusionDate",label:"Inclusion Date",type:"text",fullWidth:!0,disabled:!0,value:S?S.toLocaleDateString():""}),t.jsx(b,{margin:"dense",id:"inactivationDate",label:"Inactivation Date",type:"date",fullWidth:!0,value:l?l.toISOString().split("T")[0]:"",onChange:e=>C(new Date(e.target.value)),InputLabelProps:{shrink:!0}})]}),t.jsxs(V,{children:[t.jsx(A,{onClick:()=>o(),children:"Cancel"}),t.jsx(A,{onClick:w,children:"Save"})]}),t.jsx(Y,{open:E,onClose:()=>y(!1),onSelect:(e,a)=>{m(e),p(a.name),y(!1)},collectionName:"organization",headerText:"Select Holding Company",searchField:"name",displayFields:{primary:"name",secondary:"abbreviation"},filterFunction:e=>!e.holding||e.holding===e.id,db:g})]})},ge=()=>{const[d,o]=i.useState([]),[n,u]=i.useState(!0),[x,h]=i.useState(null),[f,S]=i.useState(null),[r,l]=i.useState(null),[C,D]=i.useState(!1),m=P(),{showConfirmation:O,showAlert:p}=K(),E=i.useCallback(async()=>{u(!0),h(null);try{const e=q(m,"organization"),s=(await Q(e)).docs.map(T=>({id:T.id,...T.data()}));o(s)}catch(e){console.error("Error fetching organizations:",e),h("Falha ao carregar organizações. Tente novamente mais tarde.")}finally{u(!1)}},[m]);i.useEffect(()=>{E()},[E]);const y=(e,a)=>{S(e.currentTarget),l(a)},j=()=>{S(null)},v=()=>{D(!0),j()},g=()=>{j(),r&&O({title:"Confirmar Exclusão",message:`Tem certeza que deseja excluir a organização ${r.name}? Esta ação não pode ser desfeita.`,onConfirm:async()=>{try{if(!r)return;const e=k(m,"organization",r.id);await ee(e),o(d.filter(a=>a.id!==r.id))}catch(e){console.error("Error deleting organization:",e),p({title:"Erro",message:"Falha ao excluir organização. Tente novamente mais tarde."})}}})},w=()=>{l(null),D(!0)};return t.jsx(ne,{title:"Gerenciador de Organizações",actions:t.jsx(A,{variant:"contained",color:"secondary",onClick:w,children:"Incluir Organização"}),children:n?t.jsx(H,{sx:{display:"flex",justifyContent:"center",mt:4},children:t.jsx(U,{})}):x?t.jsx(R,{severity:"error",children:x}):t.jsxs(H,{sx:{width:"100%",overflowX:"auto"},children:[t.jsx(ie,{component:Z,children:t.jsxs(se,{sx:{minWidth:650},"aria-label":"simple table",children:[t.jsx(oe,{children:t.jsxs(M,{children:[t.jsx(c,{children:"ID da Organização"}),t.jsx(c,{children:"Nome"}),t.jsx(c,{children:"Abreviação"}),t.jsx(c,{children:"Ações"})]})}),t.jsx(re,{children:d.map(e=>t.jsxs(M,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[t.jsx(c,{component:"th",scope:"row",children:e.id}),t.jsx(c,{children:e.name||"N/A"}),t.jsx(c,{children:e.abbreviation||"N/A"}),t.jsx(c,{children:t.jsx(W,{"aria-label":"more","aria-controls":"long-menu","aria-haspopup":"true",onClick:a=>y(a,e),children:t.jsx(te,{})})})]},e.id))})]})}),t.jsxs(_,{id:"long-menu",anchorEl:f,open:!!f,onClose:j,children:[t.jsx(N,{onClick:v,children:"Editar"}),t.jsx(N,{onClick:g,children:"Excluir"})]}),t.jsx(le,{open:C,onClose:e=>{if(e){const a=d.find(s=>s.id===e.id);o(a?d.map(s=>s.id===e.id?e:s):[e,...d])}D(!1)},organization:r})]})})};export{ge as default};
