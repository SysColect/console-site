import{A as M,aj as k,r,J as L,au as we,av as je,j as s,I as F,n as U,z as D,al as W,an as z,c as Se,aw as $,ax as ne,ay as le,az as ie,aA as ce,aB as Re,aC as de,p as Me,ar as _,aD as ke,B as P,T as A,a2 as J,e as O,aE as Le,a0 as G,aF as Fe,aG as Ue,as as De,P as He,O as Y,i as X}from"./index-CpxBzFV8.js";import{M as Ne}from"./ManageAccounts-drzDX-rV.js";import{T as ze}from"./ToolPageLayout-BQ_XzRme.js";import{f as $e}from"./dateUtils-BvssmbZU.js";import{S as Q}from"./Stack-BSaZAOx9.js";function Ee(e){return M("MuiFormGroup",e)}k("MuiFormGroup",["root","row","error"]);const Ae=e=>{const{classes:t,row:o,error:a}=e;return D({root:["root",o&&"row",a&&"error"]},Ee,t)},Ie=F("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Be=r.forwardRef(function(t,o){const a=L({props:t,name:"MuiFormGroup"}),{className:c,row:n=!1,...p}=a,l=we(),d=je({props:a,muiFormControl:l,states:["error"]}),g={...a,row:n,error:d.error},f=Ae(g);return s.jsx(Ie,{className:U(f.root,c),ownerState:g,ref:o,...p})}),pe=r.createContext();function Pe(e){return M("MuiTable",e)}k("MuiTable",["root","stickyHeader"]);const Oe=e=>{const{classes:t,stickyHeader:o}=e;return D({root:["root",o&&"stickyHeader"]},Pe,t)},Ge=F("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.stickyHeader&&t.stickyHeader]}})(W(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:t})=>t.stickyHeader,style:{borderCollapse:"separate"}}]}))),Z="table",qe=r.forwardRef(function(t,o){const a=L({props:t,name:"MuiTable"}),{className:c,component:n=Z,padding:p="normal",size:l="medium",stickyHeader:d=!1,...g}=a,f={...a,component:n,padding:p,size:l,stickyHeader:d},x=Oe(f),h=r.useMemo(()=>({padding:p,size:l,stickyHeader:d}),[p,l,d]);return s.jsx(pe.Provider,{value:h,children:s.jsx(Ge,{as:n,role:n===Z?null:"table",ref:o,className:U(x.root,c),ownerState:f,...g})})}),I=r.createContext();function We(e){return M("MuiTableBody",e)}k("MuiTableBody",["root"]);const Ve=e=>{const{classes:t}=e;return D({root:["root"]},We,t)},Ke=F("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),_e={variant:"body"},ee="tbody",Je=r.forwardRef(function(t,o){const a=L({props:t,name:"MuiTableBody"}),{className:c,component:n=ee,...p}=a,l={...a,component:n},d=Ve(l);return s.jsx(I.Provider,{value:_e,children:s.jsx(Ke,{className:U(d.root,c),as:n,ref:o,role:n===ee?null:"rowgroup",ownerState:l,...p})})});function Ye(e){return M("MuiTableCell",e)}const Xe=k("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),Qe=e=>{const{classes:t,variant:o,align:a,padding:c,size:n,stickyHeader:p}=e,l={root:["root",o,p&&"stickyHeader",a!=="inherit"&&`align${z(a)}`,c!=="normal"&&`padding${z(c)}`,`size${z(n)}`]};return D(l,Ye,t)},Ze=F("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,t[o.variant],t[`size${z(o.size)}`],o.padding!=="normal"&&t[`padding${z(o.padding)}`],o.align!=="inherit"&&t[`align${z(o.align)}`],o.stickyHeader&&t.stickyHeader]}})(W(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${Xe.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:t})=>t.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),j=r.forwardRef(function(t,o){const a=L({props:t,name:"MuiTableCell"}),{align:c="inherit",className:n,component:p,padding:l,scope:d,size:g,sortDirection:f,variant:x,...h}=a,m=r.useContext(pe),y=r.useContext(I),b=y&&y.variant==="head";let u;p?u=p:u=b?"th":"td";let C=d;u==="td"?C=void 0:!C&&b&&(C="col");const T=x||y&&y.variant,S={...a,align:c,component:u,padding:l||(m&&m.padding?m.padding:"normal"),size:g||(m&&m.size?m.size:"medium"),sortDirection:f,stickyHeader:T==="head"&&m&&m.stickyHeader,variant:T},H=Qe(S);let R=null;return f&&(R=f==="asc"?"ascending":"descending"),s.jsx(Ze,{as:u,ref:o,className:U(H.root,n),"aria-sort":R,scope:C,ownerState:S,...h})});function et(e){return M("MuiTableContainer",e)}k("MuiTableContainer",["root"]);const tt=e=>{const{classes:t}=e;return D({root:["root"]},et,t)},st=F("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),ot=r.forwardRef(function(t,o){const a=L({props:t,name:"MuiTableContainer"}),{className:c,component:n="div",...p}=a,l={...a,component:n},d=tt(l);return s.jsx(st,{ref:o,as:n,className:U(d.root,c),ownerState:l,...p})});function at(e){return M("MuiTableHead",e)}k("MuiTableHead",["root"]);const rt=e=>{const{classes:t}=e;return D({root:["root"]},at,t)},nt=F("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),lt={variant:"head"},te="thead",it=r.forwardRef(function(t,o){const a=L({props:t,name:"MuiTableHead"}),{className:c,component:n=te,...p}=a,l={...a,component:n},d=rt(l);return s.jsx(I.Provider,{value:lt,children:s.jsx(nt,{as:n,className:U(d.root,c),ref:o,role:n===te?null:"rowgroup",ownerState:l,...p})})});function ct(e){return M("MuiTableRow",e)}const se=k("MuiTableRow",["root","selected","hover","head","footer"]),dt=e=>{const{classes:t,selected:o,hover:a,head:c,footer:n}=e;return D({root:["root",o&&"selected",a&&"hover",c&&"head",n&&"footer"]},ct,t)},pt=F("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.head&&t.head,o.footer&&t.footer]}})(W(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${se.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${se.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)}}}))),oe="tr",ae=r.forwardRef(function(t,o){const a=L({props:t,name:"MuiTableRow"}),{className:c,component:n=oe,hover:p=!1,selected:l=!1,...d}=a,g=r.useContext(I),f={...a,component:n,hover:p,selected:l,head:g&&g.variant==="head",footer:g&&g.variant==="footer"},x=dt(f);return s.jsx(pt,{as:n,ref:o,className:U(x.root,c),role:n===oe?null:"row",ownerState:f,...d})}),ut=Se(s.jsx("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}));function ue(e,t){const[o,a]=r.useState(e);return r.useEffect(()=>{const c=setTimeout(()=>{a(e)},t);return()=>{clearTimeout(c)}},[e,t]),o}const gt=[],ft=({open:e,onClose:t,onUserSelect:o,additionalQueryConstraints:a=gt,dialogHeaderText:c="Selecionar Usuário",searchLabel:n="Buscar por email"})=>{const[p,l]=r.useState([]),[d,g]=r.useState(!1),[f,x]=r.useState(""),h=ue(f,500),m=r.useCallback(async b=>{g(!0);try{const u="email",C="user",T=[...a];b&&(T.push($(u,">=",b)),T.push($(u,"<=",b+"")));const S=ne(le(ie,C),...T,ce(u),Re(50)),R=(await de(S)).docs.map(E=>({id:E.id,...E.data()}));l(R)}catch(u){console.error("Error fetching users: ",u)}finally{g(!1)}},[a]);r.useEffect(()=>{e&&m(h)},[h,m,e]);const y=b=>{o(b),t()};return s.jsx(Me,{open:e,loading:d,onClose:t,onSelect:y,headerText:c,searchLabel:n,items:p,itemKey:"id",displayFields:{primary:"name",secondary:"email"},onSearchChange:x})},mt=(e="")=>e.split(" ").map(a=>a[0]).join("").toUpperCase(),q=["INFO","WARN","ERROR","DEBUG"],re=q.reduce((e,t)=>({...e,[t]:!0}),{}),Tt=()=>{const[e,t]=r.useState([]),[o,a]=r.useState(!1),[c,n]=r.useState(null),[p,l]=r.useState(!0),[d,g]=r.useState(null),[f,x]=r.useState(null),[h,m]=r.useState(""),[y,b]=r.useState(""),[u,C]=r.useState(re),[T,S]=r.useState(""),H=ue(T,500),R=r.useRef(null);r.useEffect(()=>{const i=v=>{v.ctrlKey&&v.key==="'"&&(v.preventDefault(),l(!0)),v.ctrlKey&&v.shiftKey&&v.key.toLowerCase()==="f"&&(v.preventDefault(),x(R.current))};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[]),r.useEffect(()=>{(async()=>{if(d){a(!0),n(null);try{const v=le(ie,"consoleLogs"),B=[$("userId","==",d.id)];h&&!isNaN(new Date(h).getTime())&&B.push($("timestamp",">=",X.fromDate(new Date(h)))),y&&!isNaN(new Date(y).getTime())&&B.push($("timestamp","<=",X.fromDate(new Date(y))));const xe=ne(v,...B,ce("timestamp","desc")),be=(await de(xe)).docs.flatMap(w=>{const N=w.data();return N.events&&Array.isArray(N.events)?N.events.map((K,Te)=>({...K,id:`${w.id}-${Te}`,url:N.url,userId:N.userId,timestamp:K.timestamp})):{...N,id:w.id}}),V=Object.keys(u).filter(w=>u[w]),ve=V.length===q.length,Ce=be.filter(w=>!(!ve&&!V.includes(w.level)||H&&!w.message.toLowerCase().includes(H.toLowerCase())));t(Ce)}catch(v){console.error("Error fetching logs:",v),n("Failed to fetch logs.")}finally{a(!1)}}})()},[d,h,y,u,H]);const E=i=>{g(i),l(!1)},ge=i=>{C({...u,[i.target.name]:i.target.checked})},fe=()=>{m(""),b(""),C(re),S("")},me=i=>x(i.currentTarget),he=()=>x(null),ye=!!f;return s.jsxs(ze,{title:"Visualizador de Logs",children:[p&&s.jsx(ft,{open:p,onClose:()=>l(!1),onUserSelect:E}),d&&s.jsxs(_,{sx:{p:2,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},children:[s.jsxs(Q,{direction:"row",spacing:2,alignItems:"center",children:[s.jsx(ke,{sx:{width:56,height:56},children:mt(d.name)}),s.jsxs(P,{children:[s.jsx(A,{variant:"h5",component:"div",children:d.name}),s.jsx(A,{variant:"body2",color:"text.secondary",children:d.email})]})]}),s.jsxs(Q,{direction:"row",spacing:1,alignItems:"center",sx:{mt:{xs:2,md:0}},children:[s.jsx(J,{title:"Filtros (Ctrl + Shift + F)",children:s.jsx(O,{variant:"outlined",startIcon:s.jsx(ut,{}),onClick:me,ref:R,children:"Filtros"})}),s.jsx(Le,{open:ye,anchorEl:f,onClose:he,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:s.jsxs(P,{sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:300},children:[s.jsx(A,{variant:"subtitle1",children:"Filtros"}),s.jsx(G,{label:"Início",type:"datetime-local",value:h,onChange:i=>m(i.target.value),InputLabelProps:{shrink:!0}}),s.jsx(G,{label:"Fim",type:"datetime-local",value:y,onChange:i=>b(i.target.value),InputLabelProps:{shrink:!0}}),s.jsx(G,{label:"Mensagem contém",value:T,onChange:i=>S(i.target.value)}),s.jsxs(P,{children:[s.jsx(A,{variant:"subtitle2",children:"Níveis"}),s.jsx(Be,{children:q.map(i=>s.jsx(Fe,{control:s.jsx(Ue,{checked:u[i],onChange:ge,name:i}),label:i.toUpperCase()},i))})]}),s.jsx(De,{}),s.jsx(O,{onClick:fe,variant:"outlined",size:"small",children:"Limpar Filtros"})]})}),s.jsx(J,{title:"Alterar usuário (Ctrl + ')",children:s.jsx(O,{variant:"outlined",startIcon:s.jsx(Ne,{}),onClick:()=>l(!0),children:"Alterar"})})]})]}),o&&s.jsx(He,{}),c&&s.jsx(Y,{severity:"warning",sx:{mt:2},children:c}),e.length>0?s.jsx(ot,{component:_,children:s.jsxs(qe,{sx:{minWidth:650},"aria-label":"simple table",children:[s.jsx(it,{children:s.jsxs(ae,{children:[s.jsx(j,{children:"Timestamp"}),s.jsx(j,{children:"Level"}),s.jsx(j,{children:"Message"}),s.jsx(j,{children:"URL"})]})}),s.jsx(Je,{children:e.map(i=>s.jsxs(ae,{children:[s.jsx(j,{children:$e(i.timestamp)?.toLocaleString()}),s.jsx(j,{children:i.level}),s.jsx(j,{children:i.message}),s.jsx(j,{children:i.url})]},i.id))})]})}):!o&&d&&s.jsx(Y,{severity:"info",children:"Nenhum log encontrado para este usuário com os filtros aplicados."})]})};export{Tt as default};
